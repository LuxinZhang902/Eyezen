/*! For license information please see popup.js.LICENSE.txt */
(()=>{"use strict";var e,t,r,a={463:(e,t)=>{function r(e,t){var r=e.length;e.push(t);e:for(;0<r;){var a=r-1>>>1,n=e[a];if(!(0<o(n,t)))break e;e[a]=t,e[r]=n,r=a}}function a(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var a=0,n=e.length,s=n>>>1;a<s;){var i=2*(a+1)-1,l=e[i],c=i+1,d=e[c];if(0>o(l,r))c<n&&0>o(d,l)?(e[a]=d,e[c]=r,a=c):(e[a]=l,e[i]=r,a=i);else{if(!(c<n&&0>o(d,r)))break e;e[a]=d,e[c]=r,a=c}}}return t}function o(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var i=Date,l=i.now();t.unstable_now=function(){return i.now()-l}}var c=[],d=[],m=1,u=null,h=3,g=!1,f=!1,p=!1,y="function"==typeof setTimeout?setTimeout:null,w="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var t=a(d);null!==t;){if(null===t.callback)n(d);else{if(!(t.startTime<=e))break;n(d),t.sortIndex=t.expirationTime,r(c,t)}t=a(d)}}function v(e){if(p=!1,b(e),!f)if(null!==a(c))f=!0,M(k);else{var t=a(d);null!==t&&L(v,t.startTime-e)}}function k(e,r){f=!1,p&&(p=!1,w(E),E=-1),g=!0;var o=h;try{for(b(r),u=a(c);null!==u&&(!(u.expirationTime>r)||e&&!T());){var s=u.callback;if("function"==typeof s){u.callback=null,h=u.priorityLevel;var i=s(u.expirationTime<=r);r=t.unstable_now(),"function"==typeof i?u.callback=i:u===a(c)&&n(c),b(r)}else n(c);u=a(c)}if(null!==u)var l=!0;else{var m=a(d);null!==m&&L(v,m.startTime-r),l=!1}return l}finally{u=null,h=o,g=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,C=!1,P=null,E=-1,j=5,N=-1;function T(){return!(t.unstable_now()-N<j)}function I(){if(null!==P){var e=t.unstable_now();N=e;var r=!0;try{r=P(!0,e)}finally{r?S():(C=!1,P=null)}}else C=!1}if("function"==typeof x)S=function(){x(I)};else if("undefined"!=typeof MessageChannel){var O=new MessageChannel,_=O.port2;O.port1.onmessage=I,S=function(){_.postMessage(null)}}else S=function(){y(I,0)};function M(e){P=e,C||(C=!0,S())}function L(e,r){E=y(function(){e(t.unstable_now())},r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||g||(f=!0,M(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return a(c)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var r=h;h=t;try{return e()}finally{h=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=h;h=e;try{return t()}finally{h=r}},t.unstable_scheduleCallback=function(e,n,o){var s=t.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?s+o:s,e){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return e={id:m++,callback:n,priorityLevel:e,startTime:o,expirationTime:i=o+i,sortIndex:-1},o>s?(e.sortIndex=o,r(d,e),null===a(c)&&e===a(d)&&(p?(w(E),E=-1):p=!0,L(v,o-s))):(e.sortIndex=i,r(c,e),f||g||(f=!0,M(k))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=h;return function(){var r=h;h=t;try{return e.apply(this,arguments)}finally{h=r}}}},706:(e,t,r)=>{var a=r(848),n=r(338),o=r(540),s=r(235),i=r(123);const l=(0,o.lazy)(()=>r.e(57).then(r.bind(r,57))),c=(0,o.lazy)(()=>r.e(277).then(r.bind(r,277))),d=()=>r.e(911).then(r.bind(r,911)).then(e=>e.EyeHealthScorer),m=({onStartBreak:e,onOpenSettings:t})=>{const n=(0,o.useRef)(0),[m,u]=(0,o.useState)({status:s.UserStatus.GOOD,eyeScore:{current:50,daily:50,weekly:50,trend:"stable"},realtimeScore:-1,isLoading:!0,cameraEnabled:!0,lastBreakTime:null,streakDays:0,showCameraPermissionPopup:!1,isFeatureRestricted:!1,aiRecommendation:"Analyzing your eye health patterns...",recommendedBreakType:s.BreakType.MICRO,aiLoading:!0,showLoginModal:!1,isLoggedIn:!1,userEmail:""});(0,o.useEffect)(()=>{console.log("ðŸ”¥ POPUP: useEffect triggered, calling loadUserData"),g(),h();const e=setInterval(g,3e4),t=setInterval(b,5e3),r=setInterval(()=>{v()},3e3),a=(e,t,r)=>{console.log("ðŸ”¥ POPUP: Message received:",e.type,e),"EYE_METRICS"===e.type&&(console.log("ðŸ”¥ POPUP: EYE_METRICS message received, calling handleEyeMetrics"),f(e.data))};if("undefined"!=typeof chrome&&chrome.runtime){chrome.runtime.onMessage.addListener(a),setTimeout(()=>{console.log("ðŸ§ª POPUP: Sending test message to service worker"),chrome.runtime.sendMessage({type:"POPUP_TEST",data:"Hello from popup"},e=>{console.log("ðŸ§ª POPUP: Test message response:",e)})},1e3);const e=setInterval(async()=>{try{const e=await chrome.storage.local.get(["latest_eye_metrics"]);if(e.latest_eye_metrics){const{data:t,timestamp:r}=e.latest_eye_metrics;Date.now()-r<5e3&&(console.log("ðŸ”„ POPUP: Processing eye metrics from storage fallback:",t),f(t),await chrome.storage.local.remove(["latest_eye_metrics"]))}}catch(e){console.log("ðŸ”„ POPUP: Error polling storage for metrics:",e)}},1e3);window.storagePollingInterval=e}return()=>{clearInterval(e),clearInterval(t),clearInterval(r),window.storagePollingInterval&&clearInterval(window.storagePollingInterval),"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage.removeListener(a)}},[]);const h=async()=>{try{if("undefined"!=typeof chrome&&chrome.storage){const e=(await chrome.storage.local.get(["eyezen_login_state"])).eyezen_login_state;e&&e.isLoggedIn&&u(t=>({...t,isLoggedIn:!0,userEmail:e.userEmail}))}}catch(e){console.error("Failed to load login state:",e)}},g=async()=>{console.log("ðŸ”¥ POPUP: loadUserData function called");try{let e=await i.ChromeStorageService.getUserData();if(e||(await i.ChromeStorageService.initialize(),e=await i.ChromeStorageService.getUserData()),e){const t=e.metrics.slice(-10);console.log("ðŸ” POPUP: Recent metrics for health score calculation:",t.length,t);const r=(await d()).calculateScore(t);console.log("ðŸ” POPUP: Calculated health score:",r);const a=p(r.overall,t),n=y(e.breaks),o=e.breaks.filter(e=>e.completed).sort((e,t)=>t.endTime-e.endTime)[0],i=t.reduce((e,t)=>e+(t.fatigueIndex||0),0)/t.length;let l=s.BreakType.MICRO,c="Take a quick 20-second eye break using the 20-20-20 rule.";i>.7?(l=s.BreakType.LONG,c="High eye strain detected! Take a 15-minute wellness break with TCM massage."):i>.4&&(l=s.BreakType.SHORT,c="Moderate eye fatigue. A 5-minute guided relaxation break is recommended.");const m=t[t.length-1],h=m?Math.round(Math.max(0,Math.min(100,100-100*m.fatigueIndex))):-1;window.eyeZenCameraStream=null,console.log("ðŸ” POPUP: Setting eyeScore.current to:",r.overall),u(t=>({...t,status:a,eyeScore:{current:r.overall,daily:r.overall,weekly:r.overall,trend:r.trend},realtimeScore:h,isLoading:!1,cameraEnabled:e.settings.cameraEnabled,lastBreakTime:o?.endTime||null,streakDays:n,showCameraPermissionPopup:!1,isFeatureRestricted:e.settings.metricsOnly,aiRecommendation:c,recommendedBreakType:l,aiLoading:!1,showLoginModal:!1}))}}catch(e){console.error("ðŸ”¥ POPUP: Failed to load user data:",e),console.error("ðŸ”¥ POPUP: Error stack:",e instanceof Error?e.stack:"No stack trace"),u(e=>({...e,isLoading:!1}))}},f=async e=>{try{const t=(new Date).toISOString();console.log(`ðŸ”¥ [${t}] POPUP: handleEyeMetrics called with:`,e),Date.now()-n.current>1e4&&(console.log("ðŸ‘¤ Face detected! Received eye metrics:",e),console.log("ðŸ“Š Real-time fatigue index:",e.fatigueIndex,"Blink rate:",e.blinkRate),n.current=Date.now());const a={timestamp:Date.now(),blinkRate:e.blinkRate||0,fatigueIndex:e.fatigueIndex||0,posture:e.posture||"unknown",earValue:e.earLeft||e.earRight||0,perclosValue:e.perclos||0};await i.ChromeStorageService.addMetrics(a);const o=[a],l=(await d()).calculateScore(o),c=l.overall,m=Math.max(0,Math.min(100,100-100*e.fatigueIndex)),h=p(c,[e]);console.log(`ðŸ”¥ [${t}] POPUP: Score calculation:`),console.log(`  - fatigueIndex: ${e.fatigueIndex}`),console.log(`  - Eye Health Score: ${c}`),console.log(`  - realtimeFatigueScore: ${m}`),console.log("  - Health Score Details:",l),console.log(`  - rounded Eye Health score: ${Math.round(c)}`);let g="Your eyes are healthy! Keep up the good work.",f=s.BreakType.MICRO;try{const[e,t,n]=await Promise.all([r.e(764).then(r.bind(r,764)).then(e=>e.ChromeAIService),r.e(224).then(r.bind(r,224)).then(e=>e.AICoachService),r.e(552).then(r.bind(r,552)).then(e=>e.ChromeAIVisionService)]),o=window.eyeZenCameraStream;if(o&&o.getVideoTracks().length>0){const e=document.querySelector("video");if(e){const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;const r=t.getContext("2d");if(r){r.drawImage(e,0,0);const o=t.toDataURL("image/jpeg",.8),i=await n.analyzeEyeStrain(o,a);g=i.recommendations[0]||"AI analysis completed",f=i.strainLevel>70?s.BreakType.LONG:i.strainLevel>40?s.BreakType.SHORT:s.BreakType.MICRO,console.log("ðŸ¤– Chrome AI Vision Analysis:",i)}}}}catch(t){console.warn("Chrome AI Vision analysis failed, using fallback:",t),e.fatigueIndex>.7?(g="High eye strain detected! Take a 15-minute wellness break immediately.",f=s.BreakType.LONG):e.fatigueIndex>.4?(g="Moderate eye fatigue detected. A 5-minute guided relaxation break is recommended.",f=s.BreakType.SHORT):e.blinkRate<10&&(g="Low blink rate detected. Remember to blink more frequently!",f=s.BreakType.MICRO)}u(e=>({...e,status:h,eyeScore:{...e.eyeScore,current:Math.round(c)},realtimeScore:Math.round(m),aiRecommendation:g,recommendedBreakType:f})),console.log(`ðŸ”¥ [${t}] POPUP: Updated realtimeScore:`,Math.round(m))}catch(e){console.error("Error handling eye metrics:",e)}},p=(e,t)=>e>=80?s.UserStatus.GOOD:e>=60?s.UserStatus.TIRED:s.UserStatus.CRITICAL,y=e=>{const t=new Date;let r=0;for(let a=0;a<30;a++){const n=new Date(t);n.setDate(n.getDate()-a),n.setHours(0,0,0,0);const o=new Date(n);if(o.setHours(23,59,59,999),!(e.filter(e=>{const t=new Date(e.startTime);return t>=n&&t<=o&&e.completed}).length>=3)){if(0===a)break;break}r++}return r},w=e=>e>=80?"text-green-600":e>=60?"text-yellow-600":"text-red-600",x=t=>{e(t)},b=async()=>{try{const e=await navigator.permissions.query({name:"camera"}),t=window.eyeZenCameraStream;"denied"===e.state&&t&&(console.log("Camera permission revoked, updating extension state"),window.eyeZenCameraStream=null,await i.ChromeStorageService.updateSettings({cameraEnabled:!1}),u(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1,realtimeScore:0})),chrome.runtime.sendMessage({type:"STOP_CAMERA"},e=>{chrome.runtime.lastError?console.error("âŒ Error stopping camera due to permission revocation:",chrome.runtime.lastError.message):e?.success&&console.log("Camera stopped due to permission revocation")}))}catch(e){console.log("Could not check camera permission status:",e)}},v=async()=>{try{chrome.runtime.sendMessage({type:"GET_CAMERA_STATE"},e=>{if(chrome.runtime.lastError)console.error("âŒ Error validating camera state:",chrome.runtime.lastError.message);else if(e&&void 0!==e.isActive){const t=e.isActive;m.cameraEnabled!==t&&(window.eyeZenCameraStream=!!t||null,u(e=>({...e,cameraEnabled:t})),i.ChromeStorageService.updateSettings({cameraEnabled:t}))}})}catch(e){console.log("Could not validate camera state:",e)}};return m.isLoading?(0,a.jsx)("div",{className:"w-[380px] h-[550px] bg-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading EyeZen..."})]})}):(0,a.jsxs)(a.Fragment,{children:[m.showCameraPermissionPopup&&(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:(0,a.jsx)(l,{isVisible:m.showCameraPermissionPopup,onApprove:async()=>{try{await i.ChromeStorageService.updateSettings({cameraEnabled:!0,metricsOnly:!1}),window.eyeZenCameraStream=!0,u(e=>({...e,cameraEnabled:!0,showCameraPermissionPopup:!1,isFeatureRestricted:!1}))}catch(e){console.error("Failed to approve camera access:",e)}},onReject:async()=>{try{await i.ChromeStorageService.updateSettings({cameraEnabled:!1,metricsOnly:!0}),window.eyeZenCameraStream=null,u(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1,isFeatureRestricted:!0}))}catch(e){console.error("Failed to reject camera access:",e)}},onClose:()=>u(e=>({...e,showCameraPermissionPopup:!1}))})}),(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:(0,a.jsx)(c,{isVisible:m.showLoginModal,onClose:()=>u(e=>({...e,showLoginModal:!1})),onLogin:async(e,t)=>{console.log("Login attempt:",{email:e});try{await new Promise(e=>setTimeout(e,1e3));const r=(await chrome.storage.local.get(["eyezen_users"])).eyezen_users||{};if(!r[e])throw new Error("No account found with this email address. Please sign up first.");if(r[e].password!==t)throw new Error("Incorrect password. Please try again.");u(t=>({...t,isLoggedIn:!0,userEmail:e,showLoginModal:!1})),await chrome.storage.local.set({eyezen_login_state:{isLoggedIn:!0,userEmail:e,loginTime:Date.now()}})}catch(e){throw e}},onSignup:async(e,t,r)=>{console.log("Signup attempt:",{email:e,name:r});try{await new Promise(e=>setTimeout(e,1e3));const a=(await chrome.storage.local.get(["eyezen_users"])).eyezen_users||{};if(a[e])throw new Error("An account with this email already exists. Please login instead.");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))throw new Error("Please enter a valid email address.");if(t.length<6)throw new Error("Password must be at least 6 characters long.");const n={email:e,password:t,name:r,createdAt:Date.now(),verified:!0};a[e]=n,await chrome.storage.local.set({eyezen_users:a}),u(t=>({...t,isLoggedIn:!0,userEmail:e,showLoginModal:!1})),await chrome.storage.local.set({eyezen_login_state:{isLoggedIn:!0,userEmail:e,loginTime:Date.now()}})}catch(e){throw e}}})}),(0,a.jsxs)("div",{className:"w-[380px] h-[650px] bg-white flex flex-col relative",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"text-2xl",children:"ðŸ‘ï¸"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg font-bold",children:"EyeZen"}),(0,a.jsx)("p",{className:"text-blue-100 text-xs opacity-90",children:"Eye Health Monitor"})]})]}),m.isLoggedIn?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs text-blue-100 opacity-90 truncate max-w-20",children:m.userEmail.split("@")[0]}),(0,a.jsx)("button",{onClick:async()=>{await chrome.storage.local.remove(["eyezen_login_state"]),u(e=>({...e,isLoggedIn:!1,userEmail:""}))},className:"p-1 hover:bg-white/20 rounded transition-colors",title:"Logout",children:(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]}):(0,a.jsx)("button",{onClick:()=>u(e=>({...e,showLoginModal:!0})),className:"p-2 hover:bg-white/20 rounded-lg transition-colors",title:"Login",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})]}),(0,a.jsx)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"text-lg",children:"ðŸ“¹"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-semibold text-sm",children:"Camera Monitoring"}),(0,a.jsx)("div",{className:"text-xs text-blue-100 opacity-90",children:m.cameraEnabled?"Active - Tracking eye health":"Inactive - Click to enable"}),!m.cameraEnabled&&(0,a.jsx)("button",{onClick:()=>u(e=>({...e,showCameraPermissionPopup:!0})),className:"text-xs text-blue-200 hover:text-white underline mt-1 transition-colors",children:"Need help? View setup guide"}),m.cameraEnabled&&(0,a.jsxs)("button",{onClick:async()=>{try{if(!m.cameraEnabled)return void alert("Camera must be enabled to capture frames");const e=await new Promise((e,t)=>{chrome.runtime.sendMessage({type:"DOWNLOAD_FRAME"},r=>{chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):r?e(r):t(new Error("No response received from offscreen document"))})});e.success?(console.log("ðŸ“¸ Frame downloaded successfully:",e.filename),alert(`Frame saved as: ${e.filename}`)):(console.error("âŒ Failed to download frame:",e.error),alert(`Failed to download frame: ${e.error}`))}catch(e){console.error("Failed to download frame:",e),alert("Failed to download frame. Please try again.")}},className:"text-xs text-blue-200 hover:text-white underline mt-1 transition-colors flex items-center space-x-1",children:[(0,a.jsx)("span",{children:"ðŸ“¸"}),(0,a.jsx)("span",{children:"Download Current Frame"})]})]})]}),(0,a.jsx)("button",{onClick:async()=>{try{m.cameraEnabled?await(async()=>{try{chrome.runtime.sendMessage({type:"STOP_CAMERA"},e=>{chrome.runtime.lastError?console.error("âŒ Error stopping camera:",chrome.runtime.lastError.message):e?.success&&console.log("Camera stopped successfully")}),window.eyeZenCameraStream=null,await i.ChromeStorageService.updateSettings({cameraEnabled:!1}),u(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1,realtimeScore:0})),console.log("Camera deactivated")}catch(e){console.error("Failed to stop camera:",e)}})():await(async()=>{try{if(!confirm("ðŸ“¹ Camera Permission Setup\n\nðŸ”’ Your privacy is protected - no video is recorded or transmitted, and images are only used for one-time analysis.\nContinue? (Cancel for timer-only mode)"))return await i.ChromeStorageService.updateSettings({cameraEnabled:!1,metricsOnly:!0}),void u(e=>({...e,cameraEnabled:!1,isFeatureRestricted:!0}));(await chrome.runtime.getContexts({})).find(e=>"OFFSCREEN_DOCUMENT"===e.contextType)||await chrome.offscreen.createDocument({url:"offscreen.html",reasons:[chrome.offscreen.Reason.USER_MEDIA],justification:"Camera access for eye health monitoring"});const e=await new Promise((e,t)=>{chrome.runtime.sendMessage({type:"REQUEST_CAMERA"},r=>{chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):r?e(r):t(new Error("No response received from offscreen document"))})});if(e.success)await i.ChromeStorageService.updateSettings({cameraEnabled:!0,metricsOnly:!1}),window.eyeZenCameraStream=!0,u(e=>({...e,cameraEnabled:!0,showCameraPermissionPopup:!1,isFeatureRestricted:!1})),console.log("Camera activated successfully"),alert(" Success! Camera is now active and AI eye health monitoring is running.");else{console.warn("Camera access denied:",e.error),await i.ChromeStorageService.updateSettings({cameraEnabled:!1,metricsOnly:!0}),window.eyeZenCameraStream=null,u(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1,isFeatureRestricted:!0}));const t=`${e.error||"Camera access was denied."}\n\nðŸ”§ **Why "Ask" doesn't work:**\nChrome extension popups close when permission dialogs appear, preventing you from clicking "Allow".\n\n**Solution - Set to "Always Allow":**\n\n**Method 1 - Chrome Address Bar:**\n1. Look for the camera icon (ðŸŽ¥) in Chrome's address bar\n2. Click it and select "Always allow"\n3. Refresh this extension\n\n**Method 2 - Chrome Settings:**\n1. Chrome Settings â†’ Privacy and Security â†’ Site Settings\n2. Click "Camera" â†’ find this extension\n3. Change from "Ask" to "Allow"\n4. Refresh this extension\n\nâœ… You can still use basic timer reminders without camera access.`;alert(t)}}catch(e){console.error("Failed to request camera access:",e),alert("Failed to request camera access. Please try again.")}})()}catch(e){console.error("Failed to toggle camera:",e)}},className:"relative inline-flex h-6 w-11 items-center rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/50 "+(m.cameraEnabled?"bg-green-500 shadow-lg":"bg-white/30"),children:(0,a.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200 shadow-md "+(m.cameraEnabled?"translate-x-6":"translate-x-1")})})]})})]}),(0,a.jsx)("div",{className:"p-3 relative",children:(0,a.jsx)("div",{className:"text-center mb-3",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-3 mx-1 mb-2 border border-gray-100 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-lg mr-2",children:m.eyeScore.current>=80?"ðŸ˜Š":m.eyeScore.current>=60?"ðŸ˜":m.eyeScore.current>=40?"ðŸ˜Ÿ":"ðŸ˜µ"}),(0,a.jsx)("h2",{className:"text-sm font-semibold text-gray-800",children:"Eye Health Score"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:`text-xl font-bold ${w(m.eyeScore.current)}`,children:m.eyeScore.current}),(0,a.jsx)("span",{className:"text-sm text-gray-500 ml-1",children:"/100"}),m.cameraEnabled&&50===m.eyeScore.current&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-blue-600 font-medium flex items-center",children:[(0,a.jsx)("span",{className:"animate-spin mr-1",children:"ðŸ”„"}),"Analyzing..."]})]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mb-2",children:(0,a.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-500 "+(w(m.eyeScore.current).includes("green")?"bg-green-500":w(m.eyeScore.current).includes("yellow")?"bg-yellow-500":"bg-red-500"),style:{width:`${m.eyeScore.current}%`}})}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center mb-2",children:"Based on eye strain, posture, fatigue levels"}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("button",{onClick:()=>x(s.BreakType.MICRO),className:"w-full px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:from-green-400 hover:to-emerald-400 transition-all duration-200 font-medium flex items-center justify-center space-x-2 text-sm",children:[(0,a.jsx)("span",{children:"âš¡"}),(0,a.jsx)("span",{children:"Start Recommended Break with AI"})]})})]})})}),(0,a.jsxs)("div",{className:"px-4 pb-4 flex-1 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("h3",{className:"text-xs font-medium text-gray-600 mb-1",children:"Choose Your Break"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-1",children:[(0,a.jsxs)("button",{onClick:()=>x(s.BreakType.MICRO),className:"flex flex-col items-center p-2 bg-gradient-to-br from-yellow-300 to-orange-400 hover:from-yellow-400 hover:to-orange-500 rounded border border-orange-300 transition-all duration-200 hover:shadow-md text-white",children:[(0,a.jsx)("span",{className:"text-lg mb-1",children:"âš¡"}),(0,a.jsx)("span",{className:"text-xs font-medium text-white",children:"Quick"}),(0,a.jsx)("span",{className:"text-xs text-white opacity-90",children:"20 sec"})]}),(0,a.jsxs)("button",{onClick:()=>x(s.BreakType.SHORT),className:"flex flex-col items-center p-2 bg-gradient-to-br from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 rounded border border-emerald-400 transition-all duration-200 hover:shadow-md text-white",children:[(0,a.jsx)("span",{className:"text-lg mb-1",children:"ðŸ‘ï¸"}),(0,a.jsx)("span",{className:"text-xs font-medium text-white",children:"Eye Break"}),(0,a.jsx)("span",{className:"text-xs text-white opacity-90",children:"5 min"})]}),(0,a.jsxs)("button",{onClick:()=>x(s.BreakType.LONG),className:"flex flex-col items-center p-2 bg-gradient-to-br from-purple-400 to-indigo-500 hover:from-purple-500 hover:to-indigo-600 rounded border border-indigo-400 transition-all duration-200 hover:shadow-md text-white",children:[(0,a.jsx)("span",{className:"text-lg mb-1",children:"ðŸ§˜"}),(0,a.jsx)("span",{className:"text-xs font-medium text-white",children:"Wellness"}),(0,a.jsx)("span",{className:"text-xs text-white opacity-90",children:"15 min"})]})]})]}),(0,a.jsx)("button",{onClick:t,className:"w-full mt-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"View detailed dashboard â†’"})]})]})]})};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("popup-root");e?(0,n.createRoot)(e).render((0,a.jsx)(m,{onStartBreak:e=>{chrome.runtime.sendMessage({action:"START_BREAK",breakType:e},e=>{e?.success?window.close():console.error("Failed to start break:",e?.error)})},onOpenSettings:()=>{chrome.runtime.openOptionsPage(),window.close()}})):console.error("Popup root element not found")}),window.addEventListener("error",e=>{console.error("Popup error:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("Popup unhandled promise rejection:",e.reason)})},982:(e,t,r)=>{e.exports=r(463)}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return a[e](r,r.exports,o),r.exports}o.m=a,e=[],o.O=(t,r,a,n)=>{if(!r){var s=1/0;for(d=0;d<e.length;d++){for(var[r,a,n]=e[d],i=!0,l=0;l<r.length;l++)(!1&n||s>=n)&&Object.keys(o.O).every(e=>o.O[e](r[l]))?r.splice(l--,1):(i=!1,n<s&&(s=n));if(i){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[r,a,n]},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce((t,r)=>(o.f[r](e,t),t),[])),o.u=e=>e+".js",o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},r="eyezen-chrome-extension:",o.l=(e,a,n,s)=>{if(t[e])t[e].push(a);else{var i,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var m=c[d];if(m.getAttribute("src")==e||m.getAttribute("data-webpack")==r+n){i=m;break}}i||(l=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,o.nc&&i.setAttribute("nonce",o.nc),i.setAttribute("data-webpack",r+n),i.src=e),t[e]=[a];var u=(r,a)=>{i.onerror=i.onload=null,clearTimeout(h);var n=t[e];if(delete t[e],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach(e=>e(a)),r)return r(a)},h=setTimeout(u.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=u.bind(null,i.onerror),i.onload=u.bind(null,i.onload),l&&document.head.appendChild(i)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=r[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={887:0,820:0};o.f.j=(t,r)=>{var a=o.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else if(820!=t){var n=new Promise((r,n)=>a=e[t]=[r,n]);r.push(a[2]=n);var s=o.p+o.u(t),i=new Error;o.l(s,r=>{if(o.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var n=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;i.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",i.name="ChunkLoadError",i.type=n,i.request=s,a[1](i)}},"chunk-"+t,t)}else e[t]=0},o.O.j=t=>0===e[t];var t=(t,r)=>{var a,n,[s,i,l]=r,c=0;if(s.some(t=>0!==e[t])){for(a in i)o.o(i,a)&&(o.m[a]=i[a]);if(l)var d=l(o)}for(t&&t(r);c<s.length;c++)n=s[c],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(d)},r=self.webpackChunkeyezen_chrome_extension=self.webpackChunkeyezen_chrome_extension||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=o.O(void 0,[644,123,820],()=>o(706));s=o.O(s)})();