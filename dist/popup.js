(()=>{"use strict";var e,t={948:(e,t,a)=>{var r=a(848),n=a(338),s=a(540),i=a(235),o=a(123);class l{static async initialize(){try{if(!window.ai?.languageModel)return void console.warn("Chrome AI not available. AI features will use mock data.");const e=await window.ai.languageModel.capabilities();if("no"===e.available)return void console.warn("Chrome AI model not available. AI features will use mock data.");"after-download"===e.available&&console.log("Chrome AI model downloading..."),this.session=await window.ai.languageModel.create({temperature:this.DEFAULT_TEMPERATURE,topK:this.DEFAULT_TOP_K,monitor:e=>{e.addEventListener("downloadprogress",e=>{console.log(`Chrome AI model download progress: ${Math.round(100*e.loaded)}%`)})}}),this.isInitialized=!0,console.log("Chrome AI service initialized successfully")}catch(e){console.error("Failed to initialize Chrome AI service:",e)}}static async generateCoachingScript(e,t){try{if(!this.isInitialized||!this.session)return this.getMockCoachingScript(e,t.language);const a=this.buildCoachingPrompt(e,t),r="You are an expert eye health coach specializing in Traditional Chinese Medicine and modern ergonomics. Generate helpful, encouraging, and practical coaching scripts.",n=await this.session.prompt([{role:"system",content:r},{role:"user",content:a}]),s=n?.trim()||this.getMockCoachingScript(e,t.language).content;return{id:Date.now().toString(),type:e,content:s.substring(0,300),duration:this.estimateDuration(s),language:t.language,generated:Date.now()}}catch(a){return console.error("Failed to generate coaching script:",a),this.getMockCoachingScript(e,t.language)}}static async generateWeeklySummary(e){try{if(!this.isInitialized||!this.session)return this.getMockWeeklySummary(e);const t=Date.now()-6048e5,a=Date.now(),r=e.metrics.filter(e=>e.timestamp>=t),n=e.breaks.filter(e=>e.startTime>=t),s=this.buildWeeklySummaryPrompt({metrics:r,breaks:n,settings:e.settings,currentScore:e.score}),i="You are an eye health analyst. Analyze weekly data and provide actionable insights, improvements, and recommendations in a supportive tone.",o=await this.session.prompt([{role:"system",content:i},{role:"user",content:s}])||"",l=this.parseWeeklySummary(o);return{weekStart:t,weekEnd:a,totalBreaks:n.filter(e=>e.completed).length,averageEyeScore:e.score.weekly,fatigueEvents:r.filter(t=>t.fatigueIndex>e.settings.fatigueThreshold).length,improvements:l.improvements,recommendations:l.recommendations,generated:Date.now()}}catch(t){return console.error("Failed to generate weekly summary:",t),this.getMockWeeklySummary(e)}}static async translateText(e,t){try{if(!this.isInitialized||!this.session)return`[${t.toUpperCase()}] ${e}`;const a=`Translate the following text to ${t}. Maintain the tone and context, especially for health and wellness content: "${e}"`,r="You are a professional translator. Provide accurate translations while maintaining the original meaning and tone.",n=await this.session.prompt([{role:"system",content:r},{role:"user",content:a}]);return n?.trim()||e}catch(t){return console.error("Failed to translate text:",t),e}}static async rewriteText(e,t){try{if(!this.isInitialized||!this.session)return`[${t.toUpperCase()}] ${e}`;const a=`${{formal:"Rewrite this text in a formal, professional tone",casual:"Rewrite this text in a casual, friendly tone",encouraging:"Rewrite this text to be more encouraging and motivational",concise:"Rewrite this text to be more concise while keeping the key message"}[t]}. Maintain the original meaning and context: "${e}"`,r="You are a skilled writer. Rewrite text according to the specified style while preserving the original meaning.",n=await this.session.prompt([{role:"system",content:r},{role:"user",content:a}]);return n?.trim()||e}catch(t){return console.error("Failed to rewrite text:",t),e}}static destroy(){if(this.session){try{this.session.destroy()}catch(e){console.error("Error destroying Chrome AI session:",e)}this.session=null,this.isInitialized=!1}}static buildCoachingPrompt(e,t){const a=`Current fatigue level: ${t.fatigueLevel}%, breaks taken today: ${t.breakCount}, time: ${t.timeOfDay}`;switch(e){case"motivation":return`Generate a motivational message for someone taking an eye break. ${a}. Keep it under 50 words, encouraging, and focused on eye health benefits.`;case"instruction":return`Generate clear instructions for eye exercises during a break. ${a}. Include specific techniques like the 20-20-20 rule or TCM massage points. Keep it under 60 words.`;case"relaxation":return`Generate a calming, mindful message for relaxation during an eye break. ${a}. Focus on breathing, mindfulness, and letting go of screen tension. Keep it under 50 words.`;default:return`Generate a helpful eye health message. ${a}.`}}static buildWeeklySummaryPrompt(e){return`Analyze this week's eye health data and provide insights:\n\nMetrics: ${e.metrics.length} readings, average fatigue: ${e.metrics.reduce((e,t)=>e+t.fatigueIndex,0)/e.metrics.length||0}%\nBreaks: ${e.breaks.length} total, ${e.breaks.filter(e=>e.completed).length} completed\nCurrent eye score: ${e.currentScore.current}\nSettings: ${e.settings.reminderInterval}min intervals, ${e.settings.dailyBreakGoal} daily goal\n\nProvide:\n1. 2-3 key improvements this week\n2. 2-3 actionable recommendations\n\nFormat as JSON: {"improvements": ["..."], "recommendations": ["..."]}`}static parseWeeklySummary(e){try{const t=JSON.parse(e);return{improvements:t.improvements||[],recommendations:t.recommendations||[]}}catch{const t=e.match(/improvements?[:\s]*([^\n]*)/gi)?.[0]?.split(",")||[],a=e.match(/recommendations?[:\s]*([^\n]*)/gi)?.[0]?.split(",")||[];return{improvements:t.slice(0,3),recommendations:a.slice(0,3)}}}static estimateDuration(e){const t=e.split(" ").length;return Math.max(Math.ceil(t/200*60),10)}static getMockCoachingScript(e,t){const a={motivation:{en:"Great job taking this break! Your eyes will thank you for this moment of rest. Every break brings you closer to better eye health.",zh:"å¾ˆå¥½ï¼Œä½ æ­£åœ¨ä¼‘æ¯ï¼ä½ çš„çœ¼ç›ä¼šæ„Ÿè°¢ä½ ç»™å®ƒä»¬è¿™ä¸ªä¼‘æ¯çš„æ—¶åˆ»ã€‚æ¯æ¬¡ä¼‘æ¯éƒ½è®©ä½ æ›´æŽ¥è¿‘æ›´å¥½çš„çœ¼éƒ¨å¥åº·ã€‚",es:"Â¡Excelente trabajo tomando este descanso! Tus ojos te agradecerÃ¡n este momento de descanso. Cada pausa te acerca a una mejor salud ocular."},instruction:{en:"Look at something 20 feet away for 20 seconds. Blink slowly and deliberately. Gently massage the temples in circular motions.",zh:"çœ‹å‘20è‹±å°ºå¤–çš„ç‰©ä½“20ç§’é’Ÿã€‚ç¼“æ…¢è€Œæœ‰æ„è¯†åœ°çœ¨çœ¼ã€‚è½»æŸ”åœ°ä»¥åœ†å‘¨è¿åŠ¨æŒ‰æ‘©å¤ªé˜³ç©´ã€‚",es:"Mira algo a 20 pies de distancia durante 20 segundos. Parpadea lenta y deliberadamente. Masajea suavemente las sienes con movimientos circulares."},relaxation:{en:"Take a deep breath and let your shoulders drop. Feel the tension leaving your eye muscles. You are giving yourself the gift of rest.",zh:"æ·±å‘¼å¸ï¼Œè®©è‚©è†€æ”¾æ¾ä¸‹æ¥ã€‚æ„Ÿå—çœ¼éƒ¨è‚Œè‚‰çš„ç´§å¼ æ„Ÿæ¶ˆå¤±ã€‚ä½ æ­£åœ¨ç»™è‡ªå·±ä¼‘æ¯çš„ç¤¼ç‰©ã€‚",es:"Respira profundamente y deja caer los hombros. Siente cÃ³mo la tensiÃ³n abandona los mÃºsculos de tus ojos. Te estÃ¡s dando el regalo del descanso."}},r=a[e][t]||a[e].en;return{id:Date.now().toString(),type:e,content:r,duration:this.estimateDuration(r),language:t,generated:Date.now()}}static getMockWeeklySummary(e){return{weekStart:Date.now()-6048e5,weekEnd:Date.now(),totalBreaks:e.breaks.filter(e=>e.completed).length,averageEyeScore:e.score.weekly,fatigueEvents:e.metrics.filter(t=>t.fatigueIndex>e.settings.fatigueThreshold).length,improvements:["Maintained consistent break schedule","Reduced peak fatigue incidents","Improved overall eye score trend"],recommendations:["Continue with regular 20-20-20 breaks","Consider adjusting screen brightness in the evening","Try the TCM massage techniques during longer breaks"],generated:Date.now()}}}l.session=null,l.isInitialized=!1,l.DEFAULT_TEMPERATURE=.7,l.DEFAULT_TOP_K=3,l.initialize();class c{constructor(){this.scriptCache=new Map}async generateCoachingScript(e,t,a){const r=this.generateCacheKey(e,t,a);if(this.scriptCache.has(r)){const e=this.scriptCache.get(r);if(Date.now()-e.generated<36e5)return e}try{this.buildPrompt(e,t,a);const n=await l.generateCoachingScript(this.getScriptType(e),{fatigueLevel:this.getAverageFatigue(t),breakCount:this.getDailyBreakCount(),timeOfDay:this.getTimeOfDay(),language:a.language}),s={id:this.generateId(),type:n.type,content:n.content,duration:n.duration,language:n.language,generated:n.generated};return this.scriptCache.set(r,s),s}catch(t){return console.error("Failed to generate coaching script:",t),this.getFallbackScript(e,a.language)}}async generateMotivationalMessage(e,t,a){try{const t=this.getFallbackMotivation(e,"en");return await l.translateText(t,a.language)}catch(t){return console.error("Failed to generate motivational message:",t),this.getFallbackMotivation(e,a.language)}}async generateWeeklySummary(e,t){try{const t=await l.generateWeeklySummary(e);return t.improvements.join("\n")+"\n\nRecommendations:\n"+t.recommendations.join("\n")}catch(a){return console.error("Failed to generate weekly summary:",a),this.getFallbackSummary(e,t.language)}}getAverageFatigue(e){if(!e.length)return 0;const t=e.reduce((e,t)=>{const a=t.blinkRate<15?.8:.2,r=t.fatigueIndex/100;return e+Math.max(a,r)},0);return Math.min(t/e.length,1)}getDailyBreakCount(){return parseInt(localStorage.getItem("dailyBreakCount")||"0")}getTimeOfDay(){const e=(new Date).getHours();return e<12?"morning":e<17?"afternoon":"evening"}async callChromeAI(e,t){try{return{content:await l.translateText(e,t)}}catch(e){throw new Error(`Chrome AI error: ${e}`)}}buildPrompt(e,t,a){const r=t[t.length-1],n=t.slice(-5).reduce((e,t)=>e+t.fatigueIndex,0)/5;let s=`Generate a ${e} break coaching script for a user with:\n`;switch(s+=`- Current fatigue level: ${Math.round(100*n)}%\n`,s+=`- Blink rate: ${r?.blinkRate||"unknown"} blinks/min\n`,s+=`- Posture: ${r?.posture||"unknown"}\n`,s+=`- Break duration: ${this.calculateDuration(e)} seconds\n\n`,e){case i.BreakType.MICRO:s+="Focus on quick eye exercises and blinking. Be concise and direct.";break;case i.BreakType.SHORT:s+="Include 20-20-20 rule guidance and simple stretches. Be encouraging.";break;case i.BreakType.LONG:s+="Provide comprehensive relaxation guidance including eye massage and posture correction."}return s}buildMotivationalPrompt(e,t,a){let r="Generate a motivational message for a user with:\n";return r+=`- Eye health score: ${e}/100\n`,r+=`- Current streak: ${t} days\n`,r+=`- Daily break goal: ${a.dailyBreakGoal}\n\n`,r+=e>=80?"Celebrate their excellent progress and encourage consistency.":e>=60?"Acknowledge improvement and provide gentle encouragement.":"Provide supportive motivation and simple actionable tips.",r}buildSummaryPrompt(e,t){let a="Generate a weekly eye health summary for:\n";return a+=`- Average eye health score: ${e.avgEyeHealthScore}/100\n`,a+=`- Total breaks taken: ${e.totalBreaks}\n`,a+=`- Screen time: ${Math.round(e.totalScreenTime/60)} hours\n`,a+=`- Trend: ${e.eyeHealthTrend}\n\n`,a+="Provide insights, celebrate achievements, and suggest improvements for next week.",a}getScriptType(e){switch(e){case i.BreakType.MICRO:return"instruction";case i.BreakType.SHORT:return"motivation";case i.BreakType.LONG:return"relaxation";default:return"instruction"}}calculateDuration(e){switch(e){case i.BreakType.MICRO:return 20;case i.BreakType.SHORT:return 300;case i.BreakType.LONG:return 900;default:return 20}}generateCacheKey(e,t,a){const r=t[t.length-1];return`${e}-${Math.round(10*(r?.fatigueIndex||0))/10}-${a.language}`}generateId(){return`script_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getFallbackScript(e,t){const a={en:{[i.BreakType.MICRO]:"Take a moment to blink slowly 10 times. Look away from your screen and focus on something 20 feet away for 20 seconds.",[i.BreakType.SHORT]:"It's time for a 5-minute break! Stand up, stretch your arms above your head, and do some gentle neck rolls. Remember the 20-20-20 rule: every 20 minutes, look at something 20 feet away for 20 seconds.",[i.BreakType.LONG]:"Great job taking a longer break! Spend the next 15 minutes away from all screens. Try some gentle eye massage, drink water, and do some light stretching. Your eyes will thank you!"},zh:{[i.BreakType.MICRO]:"èŠ±ä¸€ç‚¹æ—¶é—´æ…¢æ…¢çœ¨çœ¼10æ¬¡ã€‚å°†è§†çº¿ä»Žå±å¹•ä¸Šç§»å¼€ï¼Œä¸“æ³¨äºŽ20è‹±å°ºå¤–çš„ç‰©ä½“20ç§’é’Ÿã€‚",[i.BreakType.SHORT]:"æ˜¯æ—¶å€™ä¼‘æ¯5åˆ†é’Ÿäº†ï¼ç«™èµ·æ¥ï¼Œå°†æ‰‹è‡‚ä¸¾è¿‡å¤´é¡¶ï¼Œåšä¸€äº›è½»æŸ”çš„é¢ˆéƒ¨è½¬åŠ¨ã€‚è®°ä½20-20-20æ³•åˆ™ï¼šæ¯20åˆ†é’Ÿï¼Œçœ‹20è‹±å°ºå¤–çš„ç‰©ä½“20ç§’é’Ÿã€‚",[i.BreakType.LONG]:"å¾ˆå¥½ï¼Œä½ é€‰æ‹©äº†æ›´é•¿çš„ä¼‘æ¯æ—¶é—´ï¼æŽ¥ä¸‹æ¥15åˆ†é’Ÿè¿œç¦»æ‰€æœ‰å±å¹•ã€‚å°è¯•ä¸€äº›è½»æŸ”çš„çœ¼éƒ¨æŒ‰æ‘©ï¼Œå–æ°´ï¼Œåšä¸€äº›è½»åº¦æ‹‰ä¼¸ã€‚ä½ çš„çœ¼ç›ä¼šæ„Ÿè°¢ä½ çš„ï¼"}},r=a[t]||a.en;return{id:this.generateId(),type:this.getScriptType(e),content:r[e],duration:this.calculateDuration(e),language:t,generated:Date.now()}}getFallbackMotivation(e,t){const a={en:{high:"Excellent work! Your eye health is in great shape. Keep up the fantastic habits!",medium:"You're making good progress! A few more breaks each day will boost your eye health even more.",low:"Every small step counts! Start with just one extra break today and build from there."},zh:{high:"åšå¾—å¾ˆå¥½ï¼ä½ çš„çœ¼éƒ¨å¥åº·çŠ¶å†µå¾ˆå¥½ã€‚ç»§ç»­ä¿æŒè¿™äº›å¥½ä¹ æƒ¯ï¼",medium:"ä½ æ­£åœ¨å–å¾—è‰¯å¥½çš„è¿›å±•ï¼æ¯å¤©å¤šä¼‘æ¯å‡ æ¬¡ä¼šè®©ä½ çš„çœ¼éƒ¨å¥åº·æ›´ä¸Šä¸€å±‚æ¥¼ã€‚",low:"æ¯ä¸€å°æ­¥éƒ½å¾ˆé‡è¦ï¼ä»Žä»Šå¤©å¼€å§‹å¤šä¼‘æ¯ä¸€æ¬¡ï¼Œç„¶åŽé€æ­¥æ”¹å–„ã€‚"}},r=a[t]||a.en;return e>=80?r.high:e>=60?r.medium:r.low}getFallbackSummary(e,t){const a={en:`This week you took ${e.totalBreaks} breaks and maintained an average eye health score of ${e.avgEyeHealthScore}/100. Keep building on this progress!`,zh:`æœ¬å‘¨ä½ ä¼‘æ¯äº†${e.totalBreaks}æ¬¡ï¼Œå¹³å‡çœ¼éƒ¨å¥åº·å¾—åˆ†ä¸º${e.avgEyeHealthScore}/100ã€‚ç»§ç»­ä¿æŒè¿™ä¸ªè¿›æ­¥ï¼`};return a[t]||a.en}}class d{static calculateScore(e){if(0===e.length)return{overall:50,components:{eyeStrain:50,blinkHealth:50,postureHealth:50,fatigueLevel:50},trend:"stable",recommendations:["Start monitoring your eye health"]};const t=e[e.length-1],a=this.calculateAverages(e.slice(-10)),r=this.calculateEyeStrainScore(a.earValue,a.perclosValue),n=this.calculateBlinkHealthScore(a.blinkRate),s=this.calculatePostureScore(t.posture),i=100-100*a.fatigueIndex,o=Math.round(r*this.WEIGHTS.EAR+r*this.WEIGHTS.PERCLOS+n*this.WEIGHTS.BLINK_RATE+s*this.WEIGHTS.POSTURE+i*this.WEIGHTS.FATIGUE),l=this.calculateTrend(e),c=this.generateRecommendations({eyeStrain:r,blinkHealth:n,postureHealth:s,fatigueLevel:i});return{overall:Math.max(0,Math.min(100,o)),components:{eyeStrain:r,blinkHealth:n,postureHealth:s,fatigueLevel:i},trend:l,recommendations:c}}static calculateAverages(e){const t=e.reduce((e,t)=>({earValue:e.earValue+t.earValue,perclosValue:e.perclosValue+t.perclosValue,blinkRate:e.blinkRate+t.blinkRate,fatigueIndex:e.fatigueIndex+t.fatigueIndex}),{earValue:0,perclosValue:0,blinkRate:0,fatigueIndex:0}),a=e.length;return{earValue:t.earValue/a,perclosValue:t.perclosValue/a,blinkRate:t.blinkRate/a,fatigueIndex:t.fatigueIndex/a}}static calculateEyeStrainScore(e,t){const a=this.scoreByThreshold(e,this.THRESHOLDS.EAR,!0),r=this.scoreByThreshold(t,this.THRESHOLDS.PERCLOS,!1);return Math.round((a+r)/2)}static calculateBlinkHealthScore(e){const t=this.THRESHOLDS.BLINK_RATE;return e>=t.EXCELLENT.min&&e<=t.EXCELLENT.max?90:e>=t.GOOD.min&&e<=t.GOOD.max?75:e>=t.FAIR.min&&e<=t.FAIR.max?60:40}static calculatePostureScore(e){switch(e){case"excellent":return 95;case"good":return 80;case"fair":return 65;case"poor":return 45;case"very_poor":return 25;default:return 50}}static scoreByThreshold(e,t,a){return a?e>=t.EXCELLENT?90:e>=t.GOOD?75:e>=t.FAIR?60:40:e<=t.EXCELLENT?90:e<=t.GOOD?75:e<=t.FAIR?60:40}static calculateTrend(e){if(e.length<5)return"stable";const t=e.slice(-5),a=e.slice(-10,-5);if(0===a.length)return"stable";const r=t.reduce((e,t)=>e+(1-t.fatigueIndex),0)/t.length-a.reduce((e,t)=>e+(1-t.fatigueIndex),0)/a.length;return r>.05?"improving":r<-.05?"declining":"stable"}static generateRecommendations(e){const t=[];return e.eyeStrain<60&&(t.push("Take more frequent breaks to reduce eye strain"),t.push("Adjust screen brightness and contrast")),e.blinkHealth<60&&(t.push("Practice conscious blinking exercises"),t.push("Use artificial tears if eyes feel dry")),e.postureHealth<60&&(t.push("Improve your sitting posture"),t.push("Adjust monitor height to eye level")),e.fatigueLevel<60&&(t.push("Get adequate sleep (7-9 hours)"),t.push("Take longer breaks between work sessions")),0===t.length&&t.push("Great job! Keep maintaining healthy eye habits"),t}}d.WEIGHTS={EAR:.25,PERCLOS:.3,BLINK_RATE:.2,POSTURE:.15,FATIGUE:.1},d.THRESHOLDS={EAR:{EXCELLENT:.25,GOOD:.22,FAIR:.18,POOR:.15},PERCLOS:{EXCELLENT:.15,GOOD:.2,FAIR:.3,POOR:.4},BLINK_RATE:{EXCELLENT:{min:15,max:20},GOOD:{min:12,max:25},FAIR:{min:8,max:30},POOR:{min:0,max:50}}};const u=({isVisible:e,onApprove:t,onReject:a,onClose:n})=>{const[i,l]=(0,s.useState)(!1);(0,s.useEffect)(()=>{e&&l(!0)},[e]);const c=()=>{l(!1),setTimeout(()=>{n()},200)};return e?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black transition-opacity duration-200 "+(i?"opacity-50":"opacity-0"),onClick:c}),(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl max-w-sm mx-4 transform transition-all duration-200 "+(i?"scale-100 opacity-100":"scale-95 opacity-0"),children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-t-lg",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Camera Access Detected"}),(0,r.jsx)("p",{className:"text-sm opacity-90",children:"EyeZen wants to monitor your eye health"})]})]})}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Camera is currently active"})]}),(0,r.jsx)("p",{className:"text-gray-600 text-sm leading-relaxed",children:"EyeZen uses your camera to detect eye fatigue and provide personalized break recommendations. Your privacy is protected - no video is recorded or transmitted."})]}),(0,r.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:(0,r.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-yellow-800",children:"Important Choice"}),(0,r.jsx)("p",{className:"text-xs text-yellow-700 mt-1",children:"If you reject camera access, you'll only be able to use the set alarm feature."})]})]})})]}),(0,r.jsxs)("div",{className:"px-6 pb-6",children:[(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("button",{onClick:async()=>{try{await o.ChromeStorageService.updateSettings({cameraEnabled:!1,metricsOnly:!0}),a(),c()}catch(e){console.error("Failed to reject camera access:",e)}},className:"flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Reject"}),(0,r.jsx)("button",{onClick:async()=>{try{await o.ChromeStorageService.updateSettings({cameraEnabled:!0,metricsOnly:!1}),t(),c()}catch(e){console.error("Failed to approve camera access:",e)}},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"OK"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 text-center mt-3",children:"You can change this setting anytime in the extension options."})]})]})]}):null},m=({onStartBreak:e,onOpenSettings:t})=>{const[a,n]=(0,s.useState)({status:i.UserStatus.GOOD,eyeScore:{current:50,daily:50,weekly:50,trend:"stable"},isLoading:!0,cameraEnabled:!0,lastBreakTime:null,streakDays:0,showCameraPermissionPopup:!1,isFeatureRestricted:!1,aiRecommendation:"Analyzing your eye health patterns...",recommendedBreakType:i.BreakType.MICRO,aiLoading:!0});(0,s.useEffect)(()=>{l();const e=setInterval(l,3e4);return()=>clearInterval(e)},[]);const l=async()=>{try{let e=await o.ChromeStorageService.getUserData();if(e||(await o.ChromeStorageService.initialize(),e=await o.ChromeStorageService.getUserData()),e){const t=e.metrics.slice(-10),a=d.calculateScore(t),r=m(a.overall,t),s=h(e.breaks),o=e.breaks.filter(e=>e.completed).sort((e,t)=>t.endTime-e.endTime)[0],l=(new c,t.reduce((e,t)=>e+(t.fatigueIndex||0),0)/t.length);let u=i.BreakType.MICRO,g="Take a quick 20-second eye break using the 20-20-20 rule.";l>.7?(u=i.BreakType.LONG,g="High eye strain detected! Take a 15-minute wellness break with TCM massage."):l>.4&&(u=i.BreakType.SHORT,g="Moderate eye fatigue. A 5-minute guided relaxation break is recommended."),n({status:r,eyeScore:{current:a.overall,daily:a.overall,weekly:a.overall,trend:a.trend},isLoading:!1,cameraEnabled:e.settings.cameraEnabled,lastBreakTime:o?.endTime||null,streakDays:s,showCameraPermissionPopup:!1,isFeatureRestricted:e.settings.metricsOnly,aiRecommendation:g,recommendedBreakType:u,aiLoading:!1})}}catch(e){console.error("Failed to load user data:",e),n(e=>({...e,isLoading:!1}))}},m=(e,t)=>e>=80?i.UserStatus.GOOD:e>=60?i.UserStatus.TIRED:i.UserStatus.CRITICAL,h=e=>{const t=new Date;let a=0;for(let r=0;r<30;r++){const n=new Date(t);n.setDate(n.getDate()-r),n.setHours(0,0,0,0);const s=new Date(n);if(s.setHours(23,59,59,999),!(e.filter(e=>{const t=new Date(e.startTime);return t>=n&&t<=s&&e.completed}).length>=3)){if(0===r)break;break}a++}return a},g=t=>{e(t)};return a.isLoading?(0,r.jsx)("div",{className:"w-[380px] h-[550px] bg-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading EyeZen..."})]})}):(0,r.jsxs)(r.Fragment,{children:[a.showCameraPermissionPopup&&(0,r.jsx)(u,{isVisible:a.showCameraPermissionPopup,onApprove:async()=>{try{await o.ChromeStorageService.updateSettings({cameraEnabled:!0,metricsOnly:!1}),n(e=>({...e,cameraEnabled:!0,showCameraPermissionPopup:!1,isFeatureRestricted:!1}))}catch(e){console.error("Failed to approve camera access:",e)}},onReject:async()=>{try{await o.ChromeStorageService.updateSettings({cameraEnabled:!1,metricsOnly:!0}),n(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1,isFeatureRestricted:!0}))}catch(e){console.error("Failed to reject camera access:",e)}},onClose:()=>n(e=>({...e,showCameraPermissionPopup:!1}))}),(0,r.jsxs)("div",{className:"w-[380px] h-[550px] bg-white overflow-hidden flex flex-col",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"text-2xl",children:"ðŸ‘ï¸"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg font-bold",children:"EyeZen"}),(0,r.jsx)("p",{className:"text-blue-100 text-xs opacity-90",children:"Eye Health Monitor"})]})]}),(0,r.jsx)("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",title:"Open Dashboard",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})})]}),(0,r.jsx)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"text-lg",children:"ðŸ“¹"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold text-sm",children:"Camera Monitoring"}),(0,r.jsx)("div",{className:"text-xs text-blue-100 opacity-90",children:a.cameraEnabled&&!a.isFeatureRestricted?"Active - Tracking eye health":"Inactive - Limited features"})]})]}),(0,r.jsx)("button",{onClick:async()=>{try{(await o.ChromeStorageService.getSettings()).cameraEnabled?(await o.ChromeStorageService.updateSettings({cameraEnabled:!1}),n(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1}))):n(e=>({...e,showCameraPermissionPopup:!0}))}catch(e){console.error("Failed to toggle camera:",e)}},className:"relative inline-flex h-6 w-11 items-center rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/50 "+(a.cameraEnabled&&!a.isFeatureRestricted?"bg-green-500 shadow-lg":"bg-white/30"),children:(0,r.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200 shadow-md "+(a.cameraEnabled&&!a.isFeatureRestricted?"translate-x-6":"translate-x-1")})})]})})]}),(0,r.jsx)("div",{className:"p-3",children:(0,r.jsxs)("div",{className:"text-center mb-3",children:[(0,r.jsx)("div",{className:"text-3xl mb-1",children:(e=>{switch(e){case i.UserStatus.GOOD:return"ðŸ˜Š";case i.UserStatus.TIRED:return"ðŸ˜´";case i.UserStatus.CRITICAL:return"ðŸ˜µ";default:return"ðŸ˜"}})(a.status)}),(0,r.jsxs)("h2",{className:"text-base font-bold "+(p=a.eyeScore.current,p>=80?"text-green-600":p>=60?"text-yellow-600":"text-red-600"),children:["Eye Health: ",a.eyeScore.current,"/100"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-600",children:[a.streakDays," day streak â€¢ ",(e=>{if(!e)return"No recent breaks";const t=Date.now()-e,a=Math.floor(t/6e4),r=Math.floor(a/60);return r>0?`${r}h ${a%60}m ago`:`${a}m ago`})(a.lastBreakTime)]})]})}),(0,r.jsxs)("div",{className:"px-4 pb-4 flex-1",children:[(0,r.jsx)("div",{className:"mb-3 p-3 bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg",children:(0,r.jsxs)("button",{onClick:()=>g(i.BreakType.MICRO),className:"w-full px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:from-green-400 hover:to-emerald-400 transition-all duration-200 font-medium flex items-center justify-center space-x-2",children:[(0,r.jsx)("span",{children:"âš¡"}),(0,r.jsx)("span",{children:"Start Recommended Break with AI"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-700 mb-2",children:"Choose Your Break"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,r.jsxs)("button",{onClick:()=>g(i.BreakType.MICRO),className:"p-3 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors duration-200 text-center border border-blue-200",children:[(0,r.jsx)("div",{className:"text-xl mb-1",children:"âš¡"}),(0,r.jsx)("div",{className:"text-xs font-medium",children:"Quick"}),(0,r.jsx)("div",{className:"text-xs opacity-70",children:"20 sec"})]}),(0,r.jsxs)("button",{onClick:()=>g(i.BreakType.SHORT),className:"p-3 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg transition-colors duration-200 text-center border border-green-200",children:[(0,r.jsx)("div",{className:"text-xl mb-1",children:"ðŸ§˜"}),(0,r.jsx)("div",{className:"text-xs font-medium",children:"Eye Break"}),(0,r.jsx)("div",{className:"text-xs opacity-70",children:"5 min"})]}),(0,r.jsxs)("button",{onClick:()=>g(i.BreakType.LONG),className:"p-3 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg transition-colors duration-200 text-center border border-purple-200",children:[(0,r.jsx)("div",{className:"text-xl mb-1",children:"ðŸ’†"}),(0,r.jsx)("div",{className:"text-xs font-medium",children:"Wellness"}),(0,r.jsx)("div",{className:"text-xs opacity-70",children:"15 min"})]})]})]}),(0,r.jsx)("button",{onClick:t,className:"w-full mt-7 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"View detailed dashboard â†’"})]})]})]});var p};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("popup-root");e?(0,n.createRoot)(e).render((0,r.jsx)(m,{onStartBreak:e=>{chrome.runtime.sendMessage({action:"START_BREAK",breakType:e},e=>{e?.success?window.close():console.error("Failed to start break:",e?.error)})},onOpenSettings:()=>{chrome.runtime.openOptionsPage(),window.close()}})):console.error("Popup root element not found")}),window.addEventListener("error",e=>{console.error("Popup error:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("Popup unhandled promise rejection:",e.reason)})}},a={};function r(e){var n=a[e];if(void 0!==n)return n.exports;var s=a[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.m=t,e=[],r.O=(t,a,n,s)=>{if(!a){var i=1/0;for(d=0;d<e.length;d++){for(var[a,n,s]=e[d],o=!0,l=0;l<a.length;l++)(!1&s||i>=s)&&Object.keys(r.O).every(e=>r.O[e](a[l]))?a.splice(l--,1):(o=!1,s<i&&(i=s));if(o){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,n,s]},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={887:0,820:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var n,s,[i,o,l]=a,c=0;if(i.some(t=>0!==e[t])){for(n in o)r.o(o,n)&&(r.m[n]=o[n]);if(l)var d=l(r)}for(t&&t(a);c<i.length;c++)s=i[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(d)},a=self.webpackChunkeyezen_chrome_extension=self.webpackChunkeyezen_chrome_extension||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var n=r.O(void 0,[96,123,820],()=>r(948));n=r.O(n)})();