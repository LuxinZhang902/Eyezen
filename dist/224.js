"use strict";(self.webpackChunkeyezen_chrome_extension=self.webpackChunkeyezen_chrome_extension||[]).push([[224,764],{224:(e,t,n)=>{n.r(t),n.d(t,{AICoachService:()=>i,BreakActivityGenerator:()=>s,TextToSpeechService:()=>o});var a=n(235),r=n(764);class i{constructor(){this.scriptCache=new Map}async generateCoachingScript(e,t,n){const a=this.generateCacheKey(e,t,n);if(this.scriptCache.has(a)){const e=this.scriptCache.get(a);if(Date.now()-e.generated<36e5)return e}try{this.buildPrompt(e,t,n);const i=await r.ChromeAIService.generateCoachingScript(this.getScriptType(e),{fatigueLevel:this.getAverageFatigue(t),breakCount:this.getDailyBreakCount(),timeOfDay:this.getTimeOfDay(),language:n.language}),s={id:this.generateId(),type:i.type,content:i.content,duration:i.duration,language:i.language,generated:i.generated};return this.scriptCache.set(a,s),s}catch(t){return console.error("Failed to generate coaching script:",t),this.getFallbackScript(e,n.language)}}async generateMotivationalMessage(e,t,n){try{const t=this.getFallbackMotivation(e,"en");return await r.ChromeAIService.translateText(t,n.language)}catch(t){return console.error("Failed to generate motivational message:",t),this.getFallbackMotivation(e,n.language)}}async generateWeeklySummary(e,t){try{const t=await r.ChromeAIService.generateWeeklySummary(e);return t.improvements.join("\n")+"\n\nRecommendations:\n"+t.recommendations.join("\n")}catch(n){return console.error("Failed to generate weekly summary:",n),this.getFallbackSummary(e,t.language)}}getAverageFatigue(e){if(!e.length)return 0;const t=e.reduce((e,t)=>{const n=t.blinkRate<15?.8:.2,a=t.fatigueIndex/100;return e+Math.max(n,a)},0);return Math.min(t/e.length,1)}getDailyBreakCount(){return parseInt(localStorage.getItem("dailyBreakCount")||"0")}getTimeOfDay(){const e=(new Date).getHours();return e<12?"morning":e<17?"afternoon":"evening"}async callChromeAI(e,t){try{return{content:await r.ChromeAIService.translateText(e,t)}}catch(e){throw new Error(`Chrome AI error: ${e}`)}}buildPrompt(e,t,n){const r=t[t.length-1],i=t.slice(-5).reduce((e,t)=>e+t.fatigueIndex,0)/5;let s=`Generate a ${e} break coaching script for a user with:\n`;switch(s+=`- Current fatigue level: ${Math.round(100*i)}%\n`,s+=`- Blink rate: ${r?.blinkRate||"unknown"} blinks/min\n`,s+=`- Posture: ${r?.posture||"unknown"}\n`,s+=`- Break duration: ${this.calculateDuration(e)} seconds\n\n`,e){case a.BreakType.MICRO:s+="Focus on quick eye exercises and blinking. Be concise and direct.";break;case a.BreakType.SHORT:s+="Include 20-20-20 rule guidance and simple stretches. Be encouraging.";break;case a.BreakType.LONG:s+="Provide comprehensive relaxation guidance including eye massage and posture correction."}return s}buildMotivationalPrompt(e,t,n){let a="Generate a motivational message for a user with:\n";return a+=`- Eye health score: ${e}/100\n`,a+=`- Current streak: ${t} days\n`,a+=`- Daily break goal: ${n.dailyBreakGoal}\n\n`,a+=e>=80?"Celebrate their excellent progress and encourage consistency.":e>=60?"Acknowledge improvement and provide gentle encouragement.":"Provide supportive motivation and simple actionable tips.",a}buildSummaryPrompt(e,t){let n="Generate a weekly eye health summary for:\n";return n+=`- Average eye health score: ${e.avgEyeHealthScore}/100\n`,n+=`- Total breaks taken: ${e.totalBreaks}\n`,n+=`- Screen time: ${Math.round(e.totalScreenTime/60)} hours\n`,n+=`- Trend: ${e.eyeHealthTrend}\n\n`,n+="Provide insights, celebrate achievements, and suggest improvements for next week.",n}getScriptType(e){switch(e){case a.BreakType.MICRO:return"instruction";case a.BreakType.SHORT:return"motivation";case a.BreakType.LONG:return"relaxation";default:return"instruction"}}calculateDuration(e){switch(e){case a.BreakType.MICRO:return 20;case a.BreakType.SHORT:return 300;case a.BreakType.LONG:return 900;default:return 20}}generateCacheKey(e,t,n){const a=t[t.length-1];return`${e}-${Math.round(10*(a?.fatigueIndex||0))/10}-${n.language}`}generateId(){return`script_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getFallbackScript(e,t){const n={en:{[a.BreakType.MICRO]:"Take a moment to blink slowly 10 times. Look away from your screen and focus on something 20 feet away for 20 seconds.",[a.BreakType.SHORT]:"It's time for a 5-minute break! Stand up, stretch your arms above your head, and do some gentle neck rolls. Remember the 20-20-20 rule: every 20 minutes, look at something 20 feet away for 20 seconds.",[a.BreakType.LONG]:"Great job taking a longer break! Spend the next 15 minutes away from all screens. Try some gentle eye massage, drink water, and do some light stretching. Your eyes will thank you!"},zh:{[a.BreakType.MICRO]:"花一点时间慢慢眨眼10次。将视线从屏幕上移开，专注于20英尺外的物体20秒钟。",[a.BreakType.SHORT]:"是时候休息5分钟了！站起来，将手臂举过头顶，做一些轻柔的颈部转动。记住20-20-20法则：每20分钟，看20英尺外的物体20秒钟。",[a.BreakType.LONG]:"很好，你选择了更长的休息时间！接下来15分钟远离所有屏幕。尝试一些轻柔的眼部按摩，喝水，做一些轻度拉伸。你的眼睛会感谢你的！"}},r=n[t]||n.en;return{id:this.generateId(),type:this.getScriptType(e),content:r[e],duration:this.calculateDuration(e),language:t,generated:Date.now()}}getFallbackMotivation(e,t){const n={en:{high:"Excellent work! Your eye health is in great shape. Keep up the fantastic habits!",medium:"You're making good progress! A few more breaks each day will boost your eye health even more.",low:"Every small step counts! Start with just one extra break today and build from there."},zh:{high:"做得很好！你的眼部健康状况很好。继续保持这些好习惯！",medium:"你正在取得良好的进展！每天多休息几次会让你的眼部健康更上一层楼。",low:"每一小步都很重要！从今天开始多休息一次，然后逐步改善。"}},a=n[t]||n.en;return e>=80?a.high:e>=60?a.medium:a.low}getFallbackSummary(e,t){const n={en:`This week you took ${e.totalBreaks} breaks and maintained an average eye health score of ${e.avgEyeHealthScore}/100. Keep building on this progress!`,zh:`本周你休息了${e.totalBreaks}次，平均眼部健康得分为${e.avgEyeHealthScore}/100。继续保持这个进步！`};return n[t]||n.en}}class s{static generateActivities(e,t="en"){switch(e){case a.BreakType.MICRO:return this.getMicroBreakActivities(t);case a.BreakType.SHORT:return this.getShortBreakActivities(t);case a.BreakType.LONG:return this.getLongBreakActivities(t);default:return this.getMicroBreakActivities(t)}}static getMicroBreakActivities(e){const t={en:[{type:"exercise",name:"Conscious Blinking",duration:10,instructions:"Blink slowly and deliberately 10 times"},{type:"exercise",name:"20-20-20 Rule",duration:20,instructions:"Look at something 20 feet away for 20 seconds"}],zh:[{type:"exercise",name:"有意识眨眼",duration:10,instructions:"缓慢而有意识地眨眼10次"},{type:"exercise",name:"20-20-20法则",duration:20,instructions:"看20英尺外的物体20秒钟"}]};return t[e]||t.en}static getShortBreakActivities(e){const t={en:[{type:"exercise",name:"Eye Circles",duration:30,instructions:"Slowly roll your eyes in circles, 5 times each direction"},{type:"massage",name:"Temple Massage",duration:60,instructions:"Gently massage your temples in circular motions"},{type:"exercise",name:"Neck Stretch",duration:45,instructions:"Gently stretch your neck side to side and up and down"},{type:"hydration",name:"Hydration Break",duration:30,instructions:"Drink a glass of water to stay hydrated"}],zh:[{type:"exercise",name:"眼球转动",duration:30,instructions:"缓慢转动眼球，每个方向5次"},{type:"massage",name:"太阳穴按摩",duration:60,instructions:"轻柔地以圆周运动按摩太阳穴"},{type:"exercise",name:"颈部拉伸",duration:45,instructions:"轻柔地左右、上下拉伸颈部"},{type:"hydration",name:"补水休息",duration:30,instructions:"喝一杯水保持水分"}]};return t[e]||t.en}static getLongBreakActivities(e){const t={en:[{type:"massage",name:"TCM Eye Massage",duration:180,instructions:"Follow the guided TCM massage points: Zan Zhu, Si Bai, Jing Ming"},{type:"exercise",name:"Full Body Stretch",duration:120,instructions:"Stand up and do a full body stretch routine"},{type:"exercise",name:"Deep Breathing",duration:90,instructions:"Practice deep breathing exercises to relax"},{type:"hydration",name:"Mindful Hydration",duration:60,instructions:"Drink water mindfully and take a moment to rest"},{type:"exercise",name:"Eye Palming",duration:120,instructions:"Cover your eyes with palms and relax in darkness"}],zh:[{type:"massage",name:"中医眼部按摩",duration:180,instructions:"按照指导进行中医按摩穴位：攒竹、四白、睛明"},{type:"exercise",name:"全身拉伸",duration:120,instructions:"站起来做全身拉伸运动"},{type:"exercise",name:"深呼吸",duration:90,instructions:"练习深呼吸放松身心"},{type:"hydration",name:"正念补水",duration:60,instructions:"专心喝水，花一点时间休息"},{type:"exercise",name:"眼部掌敷",duration:120,instructions:"用手掌覆盖眼部，在黑暗中放松"}]};return t[e]||t.en}}class o{constructor(){this.currentUtterance=null,this.synthesis=window.speechSynthesis}speak(e,t="en-US",n=1){return new Promise((a,r)=>{if(!this.synthesis)return void r(new Error("Speech synthesis not supported"));this.stop();const i=new SpeechSynthesisUtterance(e);i.lang=t,i.rate=n,i.pitch=1,i.volume=1,i.onend=()=>{this.currentUtterance=null,a()},i.onerror=e=>{this.currentUtterance=null,r(new Error(`Speech synthesis error: ${e.error}`))},this.currentUtterance=i,this.synthesis.speak(i)})}stop(){this.synthesis&&this.synthesis.speaking&&this.synthesis.cancel(),this.currentUtterance=null}pause(){this.synthesis&&this.synthesis.speaking&&this.synthesis.pause()}resume(){this.synthesis&&this.synthesis.paused&&this.synthesis.resume()}isSpeaking(){return!!this.synthesis&&this.synthesis.speaking}getVoices(){return this.synthesis?this.synthesis.getVoices():[]}}},764:(e,t,n)=>{n.r(t),n.d(t,{ChromeAIService:()=>a,OpenAIService:()=>r,default:()=>i});class a{static async initialize(){try{if(!("LanguageModel"in window))return void console.warn("Chrome AI not available. AI features will use mock data.");const e=await window.LanguageModel.availability();if("no"===e)return void console.warn("Chrome AI model not available. AI features will use mock data.");"after-download"===e&&console.log("Chrome AI model downloading..."),this.session=await window.LanguageModel.create({temperature:this.DEFAULT_TEMPERATURE,topK:this.DEFAULT_TOP_K,monitor:e=>{e.addEventListener("downloadprogress",e=>{console.log(`Chrome AI model download progress: ${Math.round(100*e.loaded)}%`)})}}),this.isInitialized=!0,console.log("Chrome AI service initialized successfully")}catch(e){console.error("Failed to initialize Chrome AI service:",e)}}static async promptWithImage(e,t,n){try{if(await this.initialize(),!this.session)return console.warn("Chrome AI session not available for multimodal prompt"),"Chrome AI not available for image analysis";const n=[];return t&&n.push({role:"user",content:{type:"image",image:t}}),n.push({role:"user",content:e}),await this.session.prompt(n)}catch(e){return console.error("Chrome AI multimodal prompt failed:",e),"Unable to analyze image with Chrome AI"}}static async prompt(e,t){try{return await this.initialize(),this.session?await this.session.prompt(e):(console.warn("Chrome AI session not available for text prompt"),"Chrome AI not available")}catch(e){return console.error("Chrome AI text prompt failed:",e),"Unable to process request with Chrome AI"}}static async generateCoachingScript(e,t){try{if(!this.isInitialized||!this.session)return this.getMockCoachingScript(e,t.language);const n=this.buildCoachingPrompt(e,t),a="You are an expert eye health coach specializing in Traditional Chinese Medicine and modern ergonomics. Generate helpful, encouraging, and practical coaching scripts.",r=await this.session.prompt([{role:"system",content:a},{role:"user",content:n}]),i=r?.trim()||this.getMockCoachingScript(e,t.language).content;return{id:Date.now().toString(),type:e,content:i.substring(0,300),duration:this.estimateDuration(i),language:t.language,generated:Date.now()}}catch(n){return console.error("Failed to generate coaching script:",n),this.getMockCoachingScript(e,t.language)}}static async generateWeeklySummary(e){try{if(!this.isInitialized||!this.session)return this.getMockWeeklySummary(e);const t=Date.now()-6048e5,n=Date.now(),a=e.metrics.filter(e=>e.timestamp>=t),r=e.breaks.filter(e=>e.startTime>=t),i=this.buildWeeklySummaryPrompt({metrics:a,breaks:r,settings:e.settings,currentScore:e.score}),s="You are an eye health analyst. Analyze weekly data and provide actionable insights, improvements, and recommendations in a supportive tone.",o=await this.session.prompt([{role:"system",content:s},{role:"user",content:i}])||"",c=this.parseWeeklySummary(o);return{weekStart:t,weekEnd:n,totalBreaks:r.filter(e=>e.completed).length,averageEyeScore:e.score.weekly,fatigueEvents:a.filter(t=>t.fatigueIndex>e.settings.fatigueThreshold).length,improvements:c.improvements,recommendations:c.recommendations,generated:Date.now()}}catch(t){return console.error("Failed to generate weekly summary:",t),this.getMockWeeklySummary(e)}}static async translateText(e,t){try{if(!this.isInitialized||!this.session)return`[${t.toUpperCase()}] ${e}`;const n=`Translate the following text to ${t}. Maintain the tone and context, especially for health and wellness content: "${e}"`,a="You are a professional translator. Provide accurate translations while maintaining the original meaning and tone.",r=await this.session.prompt([{role:"system",content:a},{role:"user",content:n}]);return r?.trim()||e}catch(t){return console.error("Failed to translate text:",t),e}}static async rewriteText(e,t){try{if(!this.isInitialized||!this.session)return`[${t.toUpperCase()}] ${e}`;const n=`${{formal:"Rewrite this text in a formal, professional tone",casual:"Rewrite this text in a casual, friendly tone",encouraging:"Rewrite this text to be more encouraging and motivational",concise:"Rewrite this text to be more concise while keeping the key message"}[t]}. Maintain the original meaning and context: "${e}"`,a="You are a skilled writer. Rewrite text according to the specified style while preserving the original meaning.",r=await this.session.prompt([{role:"system",content:a},{role:"user",content:n}]);return r?.trim()||e}catch(t){return console.error("Failed to rewrite text:",t),e}}static destroy(){if(this.session){try{this.session.destroy()}catch(e){console.error("Error destroying Chrome AI session:",e)}this.session=null,this.isInitialized=!1}}static buildCoachingPrompt(e,t){const n=`Current fatigue level: ${t.fatigueLevel}%, breaks taken today: ${t.breakCount}, time: ${t.timeOfDay}`;switch(e){case"motivation":return`Generate a motivational message for someone taking an eye break. ${n}. Keep it under 50 words, encouraging, and focused on eye health benefits.`;case"instruction":return`Generate clear instructions for eye exercises during a break. ${n}. Include specific techniques like the 20-20-20 rule or TCM massage points. Keep it under 60 words.`;case"relaxation":return`Generate a calming, mindful message for relaxation during an eye break. ${n}. Focus on breathing, mindfulness, and letting go of screen tension. Keep it under 50 words.`;default:return`Generate a helpful eye health message. ${n}.`}}static buildWeeklySummaryPrompt(e){return`Analyze this week's eye health data and provide insights:\n\nMetrics: ${e.metrics.length} readings, average fatigue: ${e.metrics.reduce((e,t)=>e+t.fatigueIndex,0)/e.metrics.length||0}%\nBreaks: ${e.breaks.length} total, ${e.breaks.filter(e=>e.completed).length} completed\nCurrent eye score: ${e.currentScore.current}\nSettings: ${e.settings.reminderInterval}min intervals, ${e.settings.dailyBreakGoal} daily goal\n\nProvide:\n1. 2-3 key improvements this week\n2. 2-3 actionable recommendations\n\nFormat as JSON: {"improvements": ["..."], "recommendations": ["..."]}`}static parseWeeklySummary(e){try{const t=JSON.parse(e);return{improvements:t.improvements||[],recommendations:t.recommendations||[]}}catch{const t=e.match(/improvements?[:\s]*([^\n]*)/gi)?.[0]?.split(",")||[],n=e.match(/recommendations?[:\s]*([^\n]*)/gi)?.[0]?.split(",")||[];return{improvements:t.slice(0,3),recommendations:n.slice(0,3)}}}static estimateDuration(e){const t=e.split(" ").length;return Math.max(Math.ceil(t/200*60),10)}static getMockCoachingScript(e,t){const n={motivation:{en:"Great job taking this break! Your eyes will thank you for this moment of rest. Every break brings you closer to better eye health.",zh:"很好，你正在休息！你的眼睛会感谢你给它们这个休息的时刻。每次休息都让你更接近更好的眼部健康。",es:"¡Excelente trabajo tomando este descanso! Tus ojos te agradecerán este momento de descanso. Cada pausa te acerca a una mejor salud ocular."},instruction:{en:"Look at something 20 feet away for 20 seconds. Blink slowly and deliberately. Gently massage the temples in circular motions.",zh:"看向20英尺外的物体20秒钟。缓慢而有意识地眨眼。轻柔地以圆周运动按摩太阳穴。",es:"Mira algo a 20 pies de distancia durante 20 segundos. Parpadea lenta y deliberadamente. Masajea suavemente las sienes con movimientos circulares."},relaxation:{en:"Take a deep breath and let your shoulders drop. Feel the tension leaving your eye muscles. You are giving yourself the gift of rest.",zh:"深呼吸，让肩膀放松下来。感受眼部肌肉的紧张感消失。你正在给自己休息的礼物。",es:"Respira profundamente y deja caer los hombros. Siente cómo la tensión abandona los músculos de tus ojos. Te estás dando el regalo del descanso."}},a=n[e][t]||n[e].en;return{id:Date.now().toString(),type:e,content:a,duration:this.estimateDuration(a),language:t,generated:Date.now()}}static getMockWeeklySummary(e){return{weekStart:Date.now()-6048e5,weekEnd:Date.now(),totalBreaks:e.breaks.filter(e=>e.completed).length,averageEyeScore:e.score.weekly,fatigueEvents:e.metrics.filter(t=>t.fatigueIndex>e.settings.fatigueThreshold).length,improvements:["Maintained consistent break schedule","Reduced peak fatigue incidents","Improved overall eye score trend"],recommendations:["Continue with regular 20-20-20 breaks","Consider adjusting screen brightness in the evening","Try the TCM massage techniques during longer breaks"],generated:Date.now()}}}a.session=null,a.isInitialized=!1,a.DEFAULT_TEMPERATURE=.7,a.DEFAULT_TOP_K=3,a.initialize();const r=a,i=a}}]);