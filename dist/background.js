(()=>{"use strict";var e,t={235:(e,t,a)=>{var r,i,s,n;a.d(t,{M3:()=>s,a$:()=>o}),function(e){e.GOOD="good",e.FORWARD="forward",e.TILTED="tilted",e.TOO_CLOSE="too_close",e.TOO_FAR="too_far"}(r||(r={})),function(e){e.GOOD="good",e.TIRED="tired",e.CRITICAL="critical"}(i||(i={})),function(e){e.MICRO="micro",e.SHORT="short",e.LONG="long"}(s||(s={})),function(e){e.ZAN_ZHU="zan_zhu",e.SI_BAI="si_bai",e.JING_MING="jing_ming"}(n||(n={})),Error;const o={cameraEnabled:!0,detectionSensitivity:"medium",fatigueThreshold:70,reminderEnabled:!0,reminderInterval:20,breakDuration:20,dataRetention:30,metricsOnly:!1,language:"en",theme:"auto",notifications:!0,sounds:!0,dailyBreakGoal:8,eyeScoreGoal:80};n.ZAN_ZHU,n.SI_BAI,n.JING_MING},520:(e,t,a)=>{var r=a(123),i=a(235);const s="break-reminder",n="daily-summary",o="posture-check",c=20,l=30,d=1440,h=new class{constructor(){this.isInitialized=!1,this.activeBreakTabId=null}async initialize(){if(!this.isInitialized)try{chrome.alarms.onAlarm.addListener(this.handleAlarm.bind(this)),chrome.runtime.onMessage.addListener(this.handleMessage.bind(this)),chrome.runtime.onInstalled.addListener(this.handleInstall.bind(this)),chrome.runtime.onStartup.addListener(this.handleStartup.bind(this)),chrome.tabs.onRemoved.addListener(this.handleTabRemoved.bind(this)),await this.setupDefaultAlarms(),this.isInitialized=!0,console.log("EyeZen Background Service initialized")}catch(e){console.error("Failed to initialize background service:",e)}}async handleAlarm(e){console.log("Alarm triggered:",e.name);try{switch(e.name){case s:await this.handleBreakReminder();break;case o:await this.handlePostureCheck();break;case n:await this.handleDailySummary();break;case"weekly-summary":await this.handleWeeklySummary();break;default:console.log("Unknown alarm:",e.name)}}catch(t){console.error("Error handling alarm:",e.name,t)}}async handleMessage(e,t,a){try{switch(e.action){case"START_BREAK":await this.startBreak(e.breakType),a({success:!0});break;case"END_BREAK":await this.endBreak(e.breakId),a({success:!0});break;case"UPDATE_SETTINGS":await this.updateSettings(e.settings),a({success:!0});break;case"GET_STATUS":a({success:!0,data:await this.getStatus()});break;case"SNOOZE_REMINDER":await this.snoozeReminder(e.minutes||5),a({success:!0});break;default:a({success:!1,error:"Unknown action"})}}catch(e){console.error("Error handling message:",e),a({success:!1,error:String(e)})}return!0}async handleInstall(e){"install"===e.reason?(console.log("EyeZen installed for the first time"),await this.setupInitialData(),await this.showNotification({type:"basic",iconUrl:"assets/icons/icon-48.svg",title:"Welcome to EyeZen! üëÅÔ∏è",message:"Your AI eye health companion is ready. Click to get started!"})):"update"===e.reason&&console.log("EyeZen updated to version:",chrome.runtime.getManifest().version)}async handleStartup(){console.log("EyeZen service worker started"),await this.setupDefaultAlarms()}async handleTabRemoved(e){this.activeBreakTabId===e&&(this.activeBreakTabId=null,console.log("Break tab closed"))}async setupDefaultAlarms(){try{const e=await r.L_.getUserData(),t=e?.settings||i.a$;if(await chrome.alarms.clearAll(),t.reminderEnabled??1){const e=t.reminderInterval??c;await chrome.alarms.create(s,{delayInMinutes:e,periodInMinutes:e})}(t.reminderEnabled??1)&&await chrome.alarms.create(o,{delayInMinutes:l,periodInMinutes:l});const a=new Date,h=new Date;h.setHours(20,0,0,0),h<=a&&h.setDate(h.getDate()+1),await chrome.alarms.create(n,{when:h.getTime(),periodInMinutes:d}),console.log("Default alarms set up successfully")}catch(e){console.error("Failed to setup default alarms:",e)}}async handleBreakReminder(){try{const e=await r.L_.getUserData();if(!e||!e.settings.reminderEnabled)return;if(e.breaks.find(e=>!e.completed))return void console.log("User is already in a break, skipping reminder");const t=e.metrics.slice(-5),a=t.reduce((e,t)=>e+(t.fatigueIndex||0),0)/t.length;let i="üëÅÔ∏è Time for an Eye Break!",s="Follow the 20-20-20 rule: Look at something 20 feet away for 20 seconds.",n=0;a>.7?(i="‚ö†Ô∏è High Eye Strain Detected!",s="Your eyes need immediate rest. Take a break now to prevent fatigue.",n=2):a>.5&&(i="üò¥ Eyes Getting Tired",s="Time for a refreshing eye break. Your future self will thank you!",n=1),await this.showNotification({type:"basic",iconUrl:"assets/icons/icon-48.svg",title:i,message:s,priority:n,buttons:[{title:"Start Break"},{title:"Snooze 5min"}]})}catch(e){console.error("Error in break reminder:",e)}}async handlePostureCheck(){try{const e=await r.L_.getUserData();if(!e||!e.settings.reminderEnabled)return;await this.showNotification({type:"basic",iconUrl:"assets/icons/icon-48.svg",title:"üßò Posture Check",message:"Sit up straight, relax your shoulders, and adjust your screen height.",priority:0})}catch(e){console.error("Error in posture check:",e)}}async handleDailySummary(){try{const e=await r.L_.getUserData();if(!e)return;const t=new Date;t.setHours(0,0,0,0);const a=e.metrics.filter(e=>{const a=new Date(e.timestamp);return a.setHours(0,0,0,0),a.getTime()===t.getTime()}),i=e.breaks.filter(e=>{const a=new Date(e.startTime);return a.setHours(0,0,0,0),a.getTime()===t.getTime()&&e.completed}),s=a.length>0?a.reduce((e,t)=>e+(100-100*(t.fatigueIndex||0)),0)/a.length:50;await this.showNotification({type:"basic",iconUrl:"assets/icons/icon-48.svg",title:"üìä Daily Eye Health Summary",message:`Eye Health Score: ${Math.round(s)}/100 | Breaks Taken: ${i.length}`,priority:0})}catch(e){console.error("Error in daily summary:",e)}}async handleWeeklySummary(){try{await this.showNotification({type:"basic",iconUrl:"assets/icons/icon-48.svg",title:"üìà Weekly Eye Health Report",message:"Your weekly eye health report is ready! Click to view insights.",priority:1})}catch(e){console.error("Error in weekly summary:",e)}}async startBreak(e){try{const t=Date.now().toString(),a={id:t,type:e,duration:e===i.M3.MICRO?20:e===i.M3.SHORT?300:900,startTime:Date.now(),completed:!1,activities:[]},s=await r.L_.getUserData();s&&(s.breaks.push(a),await r.L_.saveUserData(s));const n=chrome.runtime.getURL(`break-ritual.html?type=${e}&id=${t}`),o=await chrome.tabs.create({url:n});this.activeBreakTabId=o.id||null,console.log("Break started:",e,t)}catch(e){throw console.error("Error starting break:",e),e}}async endBreak(e){try{const t=await r.L_.getUserData();if(t){const a=t.breaks.findIndex(t=>t.id===e);-1!==a&&(t.breaks[a].completed=!0,t.breaks[a].endTime=Date.now(),await r.L_.saveUserData(t))}console.log("Break completed:",e)}catch(e){throw console.error("Error ending break:",e),e}}async updateSettings(e){try{await r.L_.updateSettings(e),await this.setupDefaultAlarms(),console.log("Settings updated:",e)}catch(e){throw console.error("Error updating settings:",e),e}}async getStatus(){try{const e=await r.L_.getUserData();return{isActive:!0,settings:e?.settings||{},lastBreak:e?.breaks.slice(-1)[0]||null,todayMetrics:e?.metrics.filter(e=>{const t=new Date;t.setHours(0,0,0,0);const a=new Date(e.timestamp);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})||[]}}catch(e){throw console.error("Error getting status:",e),e}}async snoozeReminder(e){try{await chrome.alarms.clear(s),await chrome.alarms.create(s,{delayInMinutes:e}),console.log(`Break reminder snoozed for ${e} minutes`)}catch(e){throw console.error("Error snoozing reminder:",e),e}}async setupInitialData(){try{const e={settings:{cameraEnabled:!0,detectionSensitivity:"medium",fatigueThreshold:70,reminderEnabled:!0,reminderInterval:20,breakDuration:20,dataRetention:30,metricsOnly:!1,language:"en",theme:"light",notifications:!0,sounds:!0,dailyBreakGoal:8,eyeScoreGoal:80},metrics:[],breaks:[],events:[],score:{current:50,daily:50,weekly:50,trend:"stable"},lastUpdated:Date.now()};await r.L_.saveUserData(e),console.log("Initial data setup completed")}catch(e){console.error("Error setting up initial data:",e)}}async showNotification(e){try{const t=`eyezen-${Date.now()}`,a={type:"basic",iconUrl:"assets/icons/icon-48.svg",title:"EyeZen",message:"",priority:0,...e},r={type:"basic",iconUrl:a.iconUrl||"assets/icons/icon-48.svg",title:a.title||"EyeZen",message:a.message||""};a.buttons&&(r.buttons=a.buttons),await chrome.notifications.create(t,r),0===(e.priority||0)&&setTimeout(()=>{chrome.notifications.clear(t)},1e4)}catch(e){console.error("Error showing notification:",e)}}};h.initialize(),chrome.notifications.onClicked.addListener(e=>{e.startsWith("eyezen-")&&(chrome.action.openPopup(),chrome.notifications.clear(e))}),chrome.notifications.onButtonClicked.addListener((e,t)=>{e.startsWith("eyezen-")&&(0===t?h.initialize().then(()=>{chrome.runtime.sendMessage({action:"START_BREAK",breakType:i.M3.SHORT})}):1===t&&h.initialize().then(()=>{chrome.runtime.sendMessage({action:"SNOOZE_REMINDER",minutes:5})}),chrome.notifications.clear(e))})}},a={};function r(e){var i=a[e];if(void 0!==i)return i.exports;var s=a[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.m=t,e=[],r.O=(t,a,i,s)=>{if(!a){var n=1/0;for(d=0;d<e.length;d++){for(var[a,i,s]=e[d],o=!0,c=0;c<a.length;c++)(!1&s||n>=s)&&Object.keys(r.O).every(e=>r.O[e](a[c]))?a.splice(c--,1):(o=!1,s<n&&(n=s));if(o){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,i,s]},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={471:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var i,s,[n,o,c]=a,l=0;if(n.some(t=>0!==e[t])){for(i in o)r.o(o,i)&&(r.m[i]=o[i]);if(c)var d=c(r)}for(t&&t(a);l<n.length;l++)s=n[l],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(d)},a=self.webpackChunkeyezen_chrome_extension=self.webpackChunkeyezen_chrome_extension||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var i=r.O(void 0,[123],()=>r(520));i=r.O(i)})();