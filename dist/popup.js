/*! For license information please see popup.js.LICENSE.txt */
(()=>{"use strict";var e,r,t,a={463:(e,r)=>{function t(e,r){var t=e.length;e.push(r);e:for(;0<t;){var a=t-1>>>1,n=e[a];if(!(0<o(n,r)))break e;e[a]=r,e[t]=n,t=a}}function a(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var r=e[0],t=e.pop();if(t!==r){e[0]=t;e:for(var a=0,n=e.length,s=n>>>1;a<s;){var i=2*(a+1)-1,l=e[i],c=i+1,d=e[c];if(0>o(l,t))c<n&&0>o(d,l)?(e[a]=d,e[c]=t,a=c):(e[a]=l,e[i]=t,a=i);else{if(!(c<n&&0>o(d,t)))break e;e[a]=d,e[c]=t,a=c}}}return r}function o(e,r){var t=e.sortIndex-r.sortIndex;return 0!==t?t:e.id-r.id}if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;r.unstable_now=function(){return s.now()}}else{var i=Date,l=i.now();r.unstable_now=function(){return i.now()-l}}var c=[],d=[],m=1,u=null,h=3,g=!1,p=!1,f=!1,y="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function w(e){for(var r=a(d);null!==r;){if(null===r.callback)n(d);else{if(!(r.startTime<=e))break;n(d),r.sortIndex=r.expirationTime,t(c,r)}r=a(d)}}function v(e){if(f=!1,w(e),!p)if(null!==a(c))p=!0,M(k);else{var r=a(d);null!==r&&R(v,r.startTime-e)}}function k(e,t){p=!1,f&&(f=!1,b(C),C=-1),g=!0;var o=h;try{for(w(t),u=a(c);null!==u&&(!(u.expirationTime>t)||e&&!T());){var s=u.callback;if("function"==typeof s){u.callback=null,h=u.priorityLevel;var i=s(u.expirationTime<=t);t=r.unstable_now(),"function"==typeof i?u.callback=i:u===a(c)&&n(c),w(t)}else n(c);u=a(c)}if(null!==u)var l=!0;else{var m=a(d);null!==m&&R(v,m.startTime-t),l=!1}return l}finally{u=null,h=o,g=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,P=!1,E=null,C=-1,j=5,N=-1;function T(){return!(r.unstable_now()-N<j)}function _(){if(null!==E){var e=r.unstable_now();N=e;var t=!0;try{t=E(!0,e)}finally{t?S():(P=!1,E=null)}}else P=!1}if("function"==typeof x)S=function(){x(_)};else if("undefined"!=typeof MessageChannel){var O=new MessageChannel,I=O.port2;O.port1.onmessage=_,S=function(){I.postMessage(null)}}else S=function(){y(_,0)};function M(e){E=e,P||(P=!0,S())}function R(e,t){C=y(function(){e(r.unstable_now())},t)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(e){e.callback=null},r.unstable_continueExecution=function(){p||g||(p=!0,M(k))},r.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<e?Math.floor(1e3/e):5},r.unstable_getCurrentPriorityLevel=function(){return h},r.unstable_getFirstCallbackNode=function(){return a(c)},r.unstable_next=function(e){switch(h){case 1:case 2:case 3:var r=3;break;default:r=h}var t=h;h=r;try{return e()}finally{h=t}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(e,r){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var t=h;h=e;try{return r()}finally{h=t}},r.unstable_scheduleCallback=function(e,n,o){var s=r.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?s+o:s,e){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return e={id:m++,callback:n,priorityLevel:e,startTime:o,expirationTime:i=o+i,sortIndex:-1},o>s?(e.sortIndex=o,t(d,e),null===a(c)&&e===a(d)&&(f?(b(C),C=-1):f=!0,R(v,o-s))):(e.sortIndex=i,t(c,e),p||g||(p=!0,M(k))),e},r.unstable_shouldYield=T,r.unstable_wrapCallback=function(e){var r=h;return function(){var t=h;h=r;try{return e.apply(this,arguments)}finally{h=t}}}},706:(e,r,t)=>{var a=t(848),n=t(338),o=t(540),s=t(235),i=t(123);const l=(0,o.lazy)(()=>t.e(57).then(t.bind(t,57))),c=(0,o.lazy)(()=>t.e(277).then(t.bind(t,277))),d=()=>t.e(911).then(t.bind(t,911)).then(e=>e.EyeHealthScorer),m=({onStartBreak:e,onOpenSettings:r})=>{const t=(0,o.useRef)(0),[n,m]=(0,o.useState)({status:s.UserStatus.GOOD,eyeScore:{current:50,daily:50,weekly:50,trend:"stable"},realtimeScore:-1,isLoading:!0,cameraEnabled:!0,lastBreakTime:null,streakDays:0,showCameraPermissionPopup:!1,isFeatureRestricted:!1,aiRecommendation:"Analyzing your eye health patterns...",recommendedBreakType:s.BreakType.MICRO,aiLoading:!0,showLoginModal:!1,isLoggedIn:!1,userEmail:""});(0,o.useEffect)(()=>{console.log("🔥 POPUP: useEffect triggered, calling loadUserData"),h(),u();const e=setInterval(h,3e4),r=setInterval(x,5e3),t=setInterval(()=>{w()},3e3),a=(e,r,t)=>{console.log("🔥 POPUP: Message received:",e.type,e),"EYE_METRICS"===e.type&&(console.log("🔥 POPUP: EYE_METRICS message received, calling handleEyeMetrics"),g(e.data))};if("undefined"!=typeof chrome&&chrome.runtime){chrome.runtime.onMessage.addListener(a),setTimeout(()=>{console.log("🧪 POPUP: Sending test message to service worker"),chrome.runtime.sendMessage({type:"POPUP_TEST",data:"Hello from popup"},e=>{console.log("🧪 POPUP: Test message response:",e)})},1e3);const e=setInterval(async()=>{try{const e=await chrome.storage.local.get(["latest_eye_metrics"]);if(e.latest_eye_metrics){const{data:r,timestamp:t}=e.latest_eye_metrics;Date.now()-t<5e3&&(console.log("🔄 POPUP: Processing eye metrics from storage fallback:",r),g(r),await chrome.storage.local.remove(["latest_eye_metrics"]))}}catch(e){console.log("🔄 POPUP: Error polling storage for metrics:",e)}},1e3);window.storagePollingInterval=e}return()=>{clearInterval(e),clearInterval(r),clearInterval(t),window.storagePollingInterval&&clearInterval(window.storagePollingInterval),"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage.removeListener(a)}},[]);const u=async()=>{try{if("undefined"!=typeof chrome&&chrome.storage){const e=(await chrome.storage.local.get(["eyezen_login_state"])).eyezen_login_state;e&&e.isLoggedIn&&m(r=>({...r,isLoggedIn:!0,userEmail:e.userEmail}))}}catch(e){console.error("Failed to load login state:",e)}},h=async()=>{console.log("🔥 POPUP: loadUserData function called");try{let e=await i.ChromeStorageService.getUserData();if(e||(await i.ChromeStorageService.initialize(),e=await i.ChromeStorageService.getUserData()),e){const r=e.metrics.slice(-10);console.log("🔍 POPUP: Recent metrics for health score calculation:",r.length,r);const t=(await d()).calculateScore(r);console.log("🔍 POPUP: Calculated health score:",t);const a=p(t.overall,r),n=f(e.breaks),o=e.breaks.filter(e=>e.completed).sort((e,r)=>r.endTime-e.endTime)[0],i=r.reduce((e,r)=>e+(r.fatigueIndex||0),0)/r.length;let l=s.BreakType.MICRO,c="Take a quick 20-second eye break using the 20-20-20 rule.";i>.7?(l=s.BreakType.LONG,c="High eye strain detected! Take a 15-minute wellness break with TCM massage."):i>.4&&(l=s.BreakType.SHORT,c="Moderate eye fatigue. A 5-minute guided relaxation break is recommended.");const u=r[r.length-1],h=u?Math.round(Math.max(0,Math.min(100,100-100*u.fatigueIndex))):-1;window.eyeZenCameraStream=null,console.log("🔍 POPUP: Setting eyeScore.current to:",t.overall),m(r=>({...r,status:a,eyeScore:{current:t.overall,daily:t.overall,weekly:t.overall,trend:t.trend},realtimeScore:h,isLoading:!1,cameraEnabled:e.settings.cameraEnabled,lastBreakTime:o?.endTime||null,streakDays:n,showCameraPermissionPopup:!1,isFeatureRestricted:e.settings.metricsOnly,aiRecommendation:c,recommendedBreakType:l,aiLoading:!1,showLoginModal:!1}))}}catch(e){console.error("🔥 POPUP: Failed to load user data:",e),console.error("🔥 POPUP: Error stack:",e instanceof Error?e.stack:"No stack trace"),m(e=>({...e,isLoading:!1}))}},g=async e=>{try{const r=(new Date).toISOString();console.log(`🔥 [${r}] POPUP: handleEyeMetrics called with:`,e),Date.now()-t.current>1e4&&(console.log("👤 Face detected! Received eye metrics:",e),console.log("📊 Real-time fatigue index:",e.fatigueIndex,"Blink rate:",e.blinkRate),t.current=Date.now());const a={timestamp:Date.now(),blinkRate:e.blinkRate||0,fatigueIndex:e.fatigueIndex||0,posture:e.posture||"unknown",earValue:e.earLeft||e.earRight||0,perclosValue:e.perclos||0};await i.ChromeStorageService.addMetrics(a);const n=[a],o=(await d()).calculateScore(n),l=o.overall,c=Math.max(0,Math.min(100,100-100*e.fatigueIndex)),u=p(l,[e]);console.log(`🔥 [${r}] POPUP: Score calculation:`),console.log(`  - fatigueIndex: ${e.fatigueIndex}`),console.log(`  - Eye Health Score: ${l}`),console.log(`  - realtimeFatigueScore: ${c}`),console.log("  - Health Score Details:",o),console.log(`  - rounded Eye Health score: ${Math.round(l)}`);let h="Your eyes are healthy! Keep up the good work.",g=s.BreakType.MICRO;e.fatigueIndex>.7?(h="High eye strain detected! Take a 15-minute wellness break immediately.",g=s.BreakType.LONG):e.fatigueIndex>.4?(h="Moderate eye fatigue detected. A 5-minute guided relaxation break is recommended.",g=s.BreakType.SHORT):e.blinkRate<10&&(h="Low blink rate detected. Remember to blink more frequently!",g=s.BreakType.MICRO),m(e=>({...e,status:u,eyeScore:{...e.eyeScore,current:Math.round(l)},realtimeScore:Math.round(c),aiRecommendation:h,recommendedBreakType:g})),console.log(`🔥 [${r}] POPUP: Updated realtimeScore:`,Math.round(c))}catch(e){console.error("Error handling eye metrics:",e)}},p=(e,r)=>e>=80?s.UserStatus.GOOD:e>=60?s.UserStatus.TIRED:s.UserStatus.CRITICAL,f=e=>{const r=new Date;let t=0;for(let a=0;a<30;a++){const n=new Date(r);n.setDate(n.getDate()-a),n.setHours(0,0,0,0);const o=new Date(n);if(o.setHours(23,59,59,999),!(e.filter(e=>{const r=new Date(e.startTime);return r>=n&&r<=o&&e.completed}).length>=3)){if(0===a)break;break}t++}return t},y=e=>e>=80?"text-green-600":e>=60?"text-yellow-600":"text-red-600",b=r=>{e(r)},x=async()=>{try{const e=await navigator.permissions.query({name:"camera"}),r=window.eyeZenCameraStream;"denied"===e.state&&r&&(console.log("Camera permission revoked, updating extension state"),window.eyeZenCameraStream=null,await i.ChromeStorageService.updateSettings({cameraEnabled:!1}),m(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1,realtimeScore:0})),chrome.runtime.sendMessage({type:"STOP_CAMERA"},e=>{chrome.runtime.lastError?console.error("❌ Error stopping camera due to permission revocation:",chrome.runtime.lastError.message):e?.success&&console.log("Camera stopped due to permission revocation")}))}catch(e){console.log("Could not check camera permission status:",e)}},w=async()=>{try{chrome.runtime.sendMessage({type:"GET_CAMERA_STATE"},e=>{if(chrome.runtime.lastError)console.error("❌ Error validating camera state:",chrome.runtime.lastError.message);else if(e&&void 0!==e.isActive){const r=e.isActive;n.cameraEnabled!==r&&(window.eyeZenCameraStream=!!r||null,m(e=>({...e,cameraEnabled:r})),i.ChromeStorageService.updateSettings({cameraEnabled:r}))}})}catch(e){console.log("Could not validate camera state:",e)}};return n.isLoading?(0,a.jsx)("div",{className:"w-[380px] h-[550px] bg-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading EyeZen..."})]})}):(0,a.jsxs)(a.Fragment,{children:[n.showCameraPermissionPopup&&(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:(0,a.jsx)(l,{isVisible:n.showCameraPermissionPopup,onApprove:async()=>{try{await i.ChromeStorageService.updateSettings({cameraEnabled:!0,metricsOnly:!1}),window.eyeZenCameraStream=!0,m(e=>({...e,cameraEnabled:!0,showCameraPermissionPopup:!1,isFeatureRestricted:!1}))}catch(e){console.error("Failed to approve camera access:",e)}},onReject:async()=>{try{await i.ChromeStorageService.updateSettings({cameraEnabled:!1,metricsOnly:!0}),window.eyeZenCameraStream=null,m(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1,isFeatureRestricted:!0}))}catch(e){console.error("Failed to reject camera access:",e)}},onClose:()=>m(e=>({...e,showCameraPermissionPopup:!1}))})}),(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:(0,a.jsx)(c,{isVisible:n.showLoginModal,onClose:()=>m(e=>({...e,showLoginModal:!1})),onLogin:async(e,r)=>{console.log("Login attempt:",{email:e});try{await new Promise(e=>setTimeout(e,1e3));const t=(await chrome.storage.local.get(["eyezen_users"])).eyezen_users||{};if(!t[e])throw new Error("No account found with this email address. Please sign up first.");if(t[e].password!==r)throw new Error("Incorrect password. Please try again.");m(r=>({...r,isLoggedIn:!0,userEmail:e,showLoginModal:!1})),await chrome.storage.local.set({eyezen_login_state:{isLoggedIn:!0,userEmail:e,loginTime:Date.now()}})}catch(e){throw e}},onSignup:async(e,r,t)=>{console.log("Signup attempt:",{email:e,name:t});try{await new Promise(e=>setTimeout(e,1e3));const a=(await chrome.storage.local.get(["eyezen_users"])).eyezen_users||{};if(a[e])throw new Error("An account with this email already exists. Please login instead.");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))throw new Error("Please enter a valid email address.");if(r.length<6)throw new Error("Password must be at least 6 characters long.");const n={email:e,password:r,name:t,createdAt:Date.now(),verified:!0};a[e]=n,await chrome.storage.local.set({eyezen_users:a}),m(r=>({...r,isLoggedIn:!0,userEmail:e,showLoginModal:!1})),await chrome.storage.local.set({eyezen_login_state:{isLoggedIn:!0,userEmail:e,loginTime:Date.now()}})}catch(e){throw e}}})}),(0,a.jsxs)("div",{className:"w-[380px] h-[550px] bg-white overflow-hidden flex flex-col relative",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"text-2xl",children:"👁️"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg font-bold",children:"EyeZen"}),(0,a.jsx)("p",{className:"text-blue-100 text-xs opacity-90",children:"Eye Health Monitor"})]})]}),n.isLoggedIn?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs text-blue-100 opacity-90 truncate max-w-20",children:n.userEmail.split("@")[0]}),(0,a.jsx)("button",{onClick:async()=>{await chrome.storage.local.remove(["eyezen_login_state"]),m(e=>({...e,isLoggedIn:!1,userEmail:""}))},className:"p-1 hover:bg-white/20 rounded transition-colors",title:"Logout",children:(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]}):(0,a.jsx)("button",{onClick:()=>m(e=>({...e,showLoginModal:!0})),className:"p-2 hover:bg-white/20 rounded-lg transition-colors",title:"Login",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})]}),(0,a.jsx)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"text-lg",children:"📹"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-semibold text-sm",children:"Camera Monitoring"}),(0,a.jsx)("div",{className:"text-xs text-blue-100 opacity-90",children:n.cameraEnabled?"Active - Tracking eye health":"Inactive - Click to enable"}),!n.cameraEnabled&&(0,a.jsx)("button",{onClick:()=>m(e=>({...e,showCameraPermissionPopup:!0})),className:"text-xs text-blue-200 hover:text-white underline mt-1 transition-colors",children:"Need help? View setup guide"}),n.cameraEnabled&&(0,a.jsxs)("button",{onClick:async()=>{try{if(!n.cameraEnabled)return void alert("Camera must be enabled to capture frames");const e=await new Promise((e,r)=>{chrome.runtime.sendMessage({type:"DOWNLOAD_FRAME"},t=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):t?e(t):r(new Error("No response received from offscreen document"))})});e.success?(console.log("📸 Frame downloaded successfully:",e.filename),alert(`Frame saved as: ${e.filename}`)):(console.error("❌ Failed to download frame:",e.error),alert(`Failed to download frame: ${e.error}`))}catch(e){console.error("Failed to download frame:",e),alert("Failed to download frame. Please try again.")}},className:"text-xs text-blue-200 hover:text-white underline mt-1 transition-colors flex items-center space-x-1",children:[(0,a.jsx)("span",{children:"📸"}),(0,a.jsx)("span",{children:"Download Current Frame"})]})]})]}),(0,a.jsx)("button",{onClick:async()=>{try{n.cameraEnabled?await(async()=>{try{chrome.runtime.sendMessage({type:"STOP_CAMERA"},e=>{chrome.runtime.lastError?console.error("❌ Error stopping camera:",chrome.runtime.lastError.message):e?.success&&console.log("Camera stopped successfully")}),window.eyeZenCameraStream=null,await i.ChromeStorageService.updateSettings({cameraEnabled:!1}),m(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1,realtimeScore:0})),console.log("Camera deactivated")}catch(e){console.error("Failed to stop camera:",e)}})():await(async()=>{try{if(!confirm("📹 Camera Permission Setup\n\n🔒 Your privacy is protected - no video is recorded or transmitted, and images are only used for one-time analysis.\nContinue? (Cancel for timer-only mode)"))return await i.ChromeStorageService.updateSettings({cameraEnabled:!1,metricsOnly:!0}),void m(e=>({...e,cameraEnabled:!1,isFeatureRestricted:!0}));(await chrome.runtime.getContexts({})).find(e=>"OFFSCREEN_DOCUMENT"===e.contextType)||await chrome.offscreen.createDocument({url:"offscreen.html",reasons:[chrome.offscreen.Reason.USER_MEDIA],justification:"Camera access for eye health monitoring"});const e=await new Promise((e,r)=>{chrome.runtime.sendMessage({type:"REQUEST_CAMERA"},t=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):t?e(t):r(new Error("No response received from offscreen document"))})});if(e.success)await i.ChromeStorageService.updateSettings({cameraEnabled:!0,metricsOnly:!1}),window.eyeZenCameraStream=!0,m(e=>({...e,cameraEnabled:!0,showCameraPermissionPopup:!1,isFeatureRestricted:!1})),console.log("Camera activated successfully"),alert(" Success! Camera is now active and AI eye health monitoring is running.");else{console.warn("Camera access denied:",e.error),await i.ChromeStorageService.updateSettings({cameraEnabled:!1,metricsOnly:!0}),window.eyeZenCameraStream=null,m(e=>({...e,cameraEnabled:!1,showCameraPermissionPopup:!1,isFeatureRestricted:!0}));const r=`${e.error||"Camera access was denied."}\n\n🔧 **Why "Ask" doesn't work:**\nChrome extension popups close when permission dialogs appear, preventing you from clicking "Allow".\n\n**Solution - Set to "Always Allow":**\n\n**Method 1 - Chrome Address Bar:**\n1. Look for the camera icon (🎥) in Chrome's address bar\n2. Click it and select "Always allow"\n3. Refresh this extension\n\n**Method 2 - Chrome Settings:**\n1. Chrome Settings → Privacy and Security → Site Settings\n2. Click "Camera" → find this extension\n3. Change from "Ask" to "Allow"\n4. Refresh this extension\n\n✅ You can still use basic timer reminders without camera access.`;alert(r)}}catch(e){console.error("Failed to request camera access:",e),alert("Failed to request camera access. Please try again.")}})()}catch(e){console.error("Failed to toggle camera:",e)}},className:"relative inline-flex h-6 w-11 items-center rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/50 "+(n.cameraEnabled?"bg-green-500 shadow-lg":"bg-white/30"),children:(0,a.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200 shadow-md "+(n.cameraEnabled?"translate-x-6":"translate-x-1")})})]})})]}),(0,a.jsx)("div",{className:"p-3 relative",children:(0,a.jsx)("div",{className:"text-center mb-3",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-3 mx-1 mb-2 border border-gray-100 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-lg mr-2",children:n.eyeScore.current>=80?"😊":n.eyeScore.current>=60?"😐":n.eyeScore.current>=40?"😟":"😵"}),(0,a.jsx)("h2",{className:"text-sm font-semibold text-gray-800",children:"Eye Health Score"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:`text-xl font-bold ${y(n.eyeScore.current)}`,children:n.eyeScore.current}),(0,a.jsx)("span",{className:"text-sm text-gray-500 ml-1",children:"/100"}),n.cameraEnabled&&50===n.eyeScore.current&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-blue-600 font-medium flex items-center",children:[(0,a.jsx)("span",{className:"animate-spin mr-1",children:"🔄"}),"Analyzing..."]})]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mb-2",children:(0,a.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-500 "+(y(n.eyeScore.current).includes("green")?"bg-green-500":y(n.eyeScore.current).includes("yellow")?"bg-yellow-500":"bg-red-500"),style:{width:`${n.eyeScore.current}%`}})}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center mb-2",children:"Based on eye strain, posture, fatigue levels"}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("button",{onClick:()=>b(s.BreakType.MICRO),className:"w-full px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:from-green-400 hover:to-emerald-400 transition-all duration-200 font-medium flex items-center justify-center space-x-2 text-sm",children:[(0,a.jsx)("span",{children:"⚡"}),(0,a.jsx)("span",{children:"Start Recommended Break with AI"})]})})]})})}),(0,a.jsxs)("div",{className:"px-4 pb-4 flex-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-700 mb-2",children:"Choose Your Break"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,a.jsxs)("button",{onClick:()=>b(s.BreakType.MICRO),className:"p-3 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors duration-200 text-center border border-blue-200",children:[(0,a.jsx)("div",{className:"text-xl mb-1",children:"⚡"}),(0,a.jsx)("div",{className:"text-xs font-medium",children:"Quick"}),(0,a.jsx)("div",{className:"text-xs opacity-70",children:"20 sec"})]}),(0,a.jsxs)("button",{onClick:()=>b(s.BreakType.SHORT),className:"p-3 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg transition-colors duration-200 text-center border border-green-200",children:[(0,a.jsx)("div",{className:"text-xl mb-1",children:"🧘"}),(0,a.jsx)("div",{className:"text-xs font-medium",children:"Eye Break"}),(0,a.jsx)("div",{className:"text-xs opacity-70",children:"5 min"})]}),(0,a.jsxs)("button",{onClick:()=>b(s.BreakType.LONG),className:"p-3 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg transition-colors duration-200 text-center border border-purple-200",children:[(0,a.jsx)("div",{className:"text-xl mb-1",children:"💆"}),(0,a.jsx)("div",{className:"text-xs font-medium",children:"Wellness"}),(0,a.jsx)("div",{className:"text-xs opacity-70",children:"15 min"})]})]})]}),(0,a.jsx)("button",{onClick:r,className:"w-full mt-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"View detailed dashboard →"})]})]})]})};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("popup-root");e?(0,n.createRoot)(e).render((0,a.jsx)(m,{onStartBreak:e=>{chrome.runtime.sendMessage({action:"START_BREAK",breakType:e},e=>{e?.success?window.close():console.error("Failed to start break:",e?.error)})},onOpenSettings:()=>{chrome.runtime.openOptionsPage(),window.close()}})):console.error("Popup root element not found")}),window.addEventListener("error",e=>{console.error("Popup error:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("Popup unhandled promise rejection:",e.reason)})},982:(e,r,t)=>{e.exports=t(463)}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var t=n[e]={exports:{}};return a[e](t,t.exports,o),t.exports}o.m=a,e=[],o.O=(r,t,a,n)=>{if(!t){var s=1/0;for(d=0;d<e.length;d++){for(var[t,a,n]=e[d],i=!0,l=0;l<t.length;l++)(!1&n||s>=n)&&Object.keys(o.O).every(e=>o.O[e](t[l]))?t.splice(l--,1):(i=!1,n<s&&(s=n));if(i){e.splice(d--,1);var c=a();void 0!==c&&(r=c)}}return r}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[t,a,n]},o.d=(e,r)=>{for(var t in r)o.o(r,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce((r,t)=>(o.f[t](e,r),r),[])),o.u=e=>e+".js",o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),r={},t="eyezen-chrome-extension:",o.l=(e,a,n,s)=>{if(r[e])r[e].push(a);else{var i,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var m=c[d];if(m.getAttribute("src")==e||m.getAttribute("data-webpack")==t+n){i=m;break}}i||(l=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,o.nc&&i.setAttribute("nonce",o.nc),i.setAttribute("data-webpack",t+n),i.src=e),r[e]=[a];var u=(t,a)=>{i.onerror=i.onload=null,clearTimeout(h);var n=r[e];if(delete r[e],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach(e=>e(a)),t)return t(a)},h=setTimeout(u.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=u.bind(null,i.onerror),i.onload=u.bind(null,i.onload),l&&document.head.appendChild(i)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var r=o.g.document;if(!e&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(e=r.currentScript.src),!e)){var t=r.getElementsByTagName("script");if(t.length)for(var a=t.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=t[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={887:0,820:0};o.f.j=(r,t)=>{var a=o.o(e,r)?e[r]:void 0;if(0!==a)if(a)t.push(a[2]);else if(820!=r){var n=new Promise((t,n)=>a=e[r]=[t,n]);t.push(a[2]=n);var s=o.p+o.u(r),i=new Error;o.l(s,t=>{if(o.o(e,r)&&(0!==(a=e[r])&&(e[r]=void 0),a)){var n=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;i.message="Loading chunk "+r+" failed.\n("+n+": "+s+")",i.name="ChunkLoadError",i.type=n,i.request=s,a[1](i)}},"chunk-"+r,r)}else e[r]=0},o.O.j=r=>0===e[r];var r=(r,t)=>{var a,n,[s,i,l]=t,c=0;if(s.some(r=>0!==e[r])){for(a in i)o.o(i,a)&&(o.m[a]=i[a]);if(l)var d=l(o)}for(r&&r(t);c<s.length;c++)n=s[c],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(d)},t=self.webpackChunkeyezen_chrome_extension=self.webpackChunkeyezen_chrome_extension||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})();var s=o.O(void 0,[644,123,820],()=>o(706));s=o.O(s)})();